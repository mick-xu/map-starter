!function(X){"use strict";var r=X.ht,E=r.Default,m=E.getInternal(),i=m.ui(),P=null,Y="__segmentLengths",s="__lineTotalLength",a="__linePoints",$="__distance0",g="flow.count",t="flow.step",x="flow.element.max",I="flow.element.count",K="flow.element.min",L="flow.element.space",Q="flow.element.autorotate",d="flow.element.background",H="flow.element.shadow.max",e="flow.element.shadow.min",z="flow.element.shadow.begincolor",T="flow.element.shadow.endcolor",C="flow.element.shadow.visible",n="flow.element.image",Z="flow",F=r.Math.Vector2,u=new F;new F,new F,r.List;var M=r.Default._edgeProtectMethod,h=M.getStraightLinePoints,J=function(K,y){for(var C=[],G=K.length,j=0;G>j;j++){var l=K[j];l._as&&(l=l._as);for(var x=l[0],i=1;i<l.length;i++)C.push([x,l[i]]),x=l[i]}for(var A=[],j=0;j<C.length;j++){var Q=N(C[j][0],C[j][1],y);A.push(Q)}return{distance:A,segments:C}},y=function(h,D,m){if(h){for(var k,$=J(h,D),F=$.distance,n=$.segments,d=1/0,c=null,H=0,W=F.length;W>H;H++){var l=F[H];l.z<d&&(k=H,d=l.z,c=l)}if(null==m&&(m=.1),c.z<m){for(var X=0,Y=0;k>=Y;Y++)X+=E.getDistance(n[Y][0],k>Y?n[Y][1]:c);return X}}},N=function(_,E,R){var P=_.x,I=_.y,X=E.x,k=E.y,N=R.x,t=R.y,S=X-P,g=k-I,B=Math.sqrt(S*S+g*g),u=S/B,H=g/B,p=(-P+N)*u+(-I+t)*H,q={x:P+p*u,y:I+p*H};return q.x>=Math.min(_.x,E.x)&&q.x<=Math.max(_.x,E.x)&&q.y>=Math.min(_.y,E.y)&&q.y<=Math.max(_.y,E.y)||(q.x=Math.abs(q.x-_.x)<Math.abs(q.x-E.x)?_.x:E.x,q.y=Math.abs(q.y-_.y)<Math.abs(q.y-E.y)?_.y:E.y),S=N-q.x,g=t-q.y,q.z=Math.sqrt(S*S+g*g),q},_=function(w,N){if(w){var K=J(w,N).distance,U=1/0,j=null;return K.forEach(function(A){A.z<U&&(U=A.z,j=A)}),j}},c=M.calculateLineLength,j=M.calcSegmentIndexByDistance,k=M.calculatePointAlongLine,o=function(g,F,d){if(!g)return d;if(0===F){var J=g[0][0],E=g[0][1];return d+Math.atan2(E.y-J.y,E.x-J.x)}if(100===F){g=g[g.length-1];var J=g[g.length-2],E=g[g.length-1];return d+Math.atan2(E.y-J.y,E.x-J.x)}for(var b=0,p=[],H=g.length,N=0;H>N;N++){var V=g[N],M=c(V);b+=M,p.push(M)}for(var Q=b*F/100,U=j(Q,p),A=0,f=0;U>f;f++)A+=p[f];Q-=A;for(var L=k(g[U],Q),$=g[U],n=0,x=0,r=0;r<$.length-1;r++){var D=$[r],B=$[r+1],i=B.x-D.x,u=B.y-D.y,X=Math.sqrt(i*i+u*u);if(n+=X,n>Q){x=r;break}}var t=$[x];return d+Math.atan2(L.y-t.y,L.x-t.x)},v=function(C){var e=0;if(C)if(Array.isArray(C[0]))for(var w=C.length,x=0;w>x;x++){var Z=C[x],s=c(Z);e+=s}else e=c(C);return e},S=function(o,H,v,P){return u.set(H,v).rotateAround(null,P),o?{x:o.x+u.x,y:o.y+u.y}:{x:u.x,y:u.y}},R=function(S){var m=S._data,B=h(S);if(B){m.s("flow.reverse")&&(B.reverse(),B.forEach(function(n){n.reverse()}));for(var X=0,i=[],T=B.length,u=0;T>u;u++){var z=B[u],v=c(z);X+=v,i.push(v)}if(m[Y]=i,m[s]=X,m[a]=B,m instanceof r.Edge){var b=E.unionPoint(B),Q=b.x+b.width/2,_=b.y+b.height/2;m.$10e={x:Q,y:_}}U(S,!0)}},p=M.getPercentPosition,U=function(u,n){var q=u._data,z=q[s],M=q.s(g),R=q.s(t),D=0,h=q[Y],f=q.s(x),H=q.s(K),F=q.s(I),U=(f-H)/(F-1),J=[];if(h){if(1===F)J.push(f);else if(2===F)J.push(f),J.push(H);else{if(!(F>2))return;J.push(f);for(var S=F-2;S>0;S--)J.push(H+U*S);J.push(H)}var N=0,V=0;J.forEach(function($){F-1>N&&(V+=q.getFlowElementSpace($)),N++}),V+=(f+H)/2,D=(z-M*V+V)/M;var A=u[$];for(null==A&&(A=0),n||(A+=R);A>z+V;){var X=u._overCount;X?X++:X=1,X>=M&&(X=null),u._overCount=X,q.s("flow.autoreverse")?X?A-=D+V:(A=0,q.s("flow.reverse",!q.s("flow.reverse"))):A-=D+V}u[$]=A}},q="prototype",l=r.graph.GraphView[q],w=r.Data[q],b=i.DataUI[q],A=i.ShapeUI[q],G=i.EdgeUI[q],D=r.DataModel[q],f=r.Style;f[x]==P&&(f[x]=7),f[K]==P&&(f[K]=0),f[g]==P&&(f[g]=1),f[t]==P&&(f[t]=3),f[I]==P&&(f[I]=10),f[L]==P&&(f[L]=3.5),f[Q]==P&&(f[Q]=!1),f[d]==P&&(f[d]="rgba(255, 255, 114, 0.4)"),f[z]==P&&(f[z]="rgba(255, 255, 0, 0.3)"),f[T]==P&&(f[T]="rgba(255, 255, 0, 0)"),f[C]==P&&(f[C]=1),f[H]==P&&(f[H]=22),f[e]==P&&(f[e]=4),l.calculatePointLength=function(d,t,w){var Q=this.getDataUI(d),n=h(Q);return y(n,t,w)},E.calculatePointLength=function(d,A,I,K){var S=h(P,d,A);return y(S,I,K)},E.calculateClosestPointOnLine=N,l.calculateClosestPoint=function(n,i){var c=this.getDataUI(n),v=h(c);return _(v,i)},E.calculateClosestPoint=function(J,d,R){var x=h(P,J,d);return _(x,R)},l.getPercentAngle=function(B,F){var k=this.getDataUI(B),M=h(k);return B.getRotation?B.getRotation():0,o(M,F,B.getRotation?B.getRotation():0)},E.getPercentAngle=function(z,H,m){var w=h(P,z,H);return o(w,m,0)},l.calculateLength=function(y){var R=this.getDataUI(y),C=h(R);return v(C)},E.calculateLength=function(A,l){var z=h(P,A,l);return v(z)},l.getPercentPosition=function(A,P){var G=this.getDataUI(A),i=h(G);return p(i,P)},E.getPercentPositionOnPoints=function(s,N,$){var m=h(P,s,N);return p(m,$)};var V=function(o){var Y=o.data,z=this.dm();if(Y&&"add"===o.kind){var R=z.$3e;R&&Y.s(Z)&&R.indexOf(Y)<0&&R.push(Y)}"clear"===o.kind&&(z.$3e=[])},B=function(j){var J=j.property,t=j.data,W=j.newValue,V=this.dm().$3e;if(V&&"s:flow"===J)if(W)V.indexOf(t)<0&&V.push(t);else for(var U=V.length,q=0;U>q;q++)if(V[q]===t){V.splice(q,1);break}},O=l.setDataModel;l.setDataModel=function(l){var L=this,U=L._dataModel;if(U!==l){U&&(U.umm(V,L),U.umd(B,L),U.$3e=[]),l.mm(V,L),l.md(B,L);var H=l.$3e=[];l.each(function(Q){Q.s(Z)&&H.indexOf(Q)<0&&H.push(Q)}),O.call(L,l)}},w.getFlowElementSpace=function(){return this.s(L)};var W=function(f){var n=this,N=n._data,B=N[s],F=N[Y],V=N[a],L=N.s(g),J=0,X=n[$],u=N.s(x),m=N.s(K),i=N.s(I),v=N.s(e),R=N.s(H),W=N.s(Q),r=(R-v)/(i-1),y=(u-m)/(i-1),b=N.getRotation?N.getRotation():0,w=N.getPosition?N.p():N.$10e,_=[],c=[];if(X!=P){if(1===i)_.push(u);else if(2===i)_.push(u),_.push(m);else{if(!(i>2))return;_.push(u);for(var z=i-2;z>0;z--)_.push(m+y*z);_.push(m)}if(1===i)c.push(R);else if(2===i)c.push(R),c.push(v);else{if(!(i>2))return;c.push(R);for(var z=i-2;z>0;z--)c.push(v+r*z);c.push(v)}var O=0,h=0;_.forEach(function(o){i-1>O&&(h+=N.getFlowElementSpace(o)),O++}),h+=(u+m)/2,J=(B-L*h+h)/L,f.save();for(var z=0;L>z;z++){var o=X,l=0,t=n._overCount,q=0;N.s("flow.autoreverse")&&t&&t>L-(z+1)||(o-=z*(J+h),O=0,_.forEach(function(v){var e=o-l;if(e>=0&&B>e){var R=!0,u=j(e,F);q=0;for(var h=0;u>h;h++)q+=F[h];if(e-=q,R){var P=k(V[u],e),r=b;if(W){for(var U=V[u],J=0,s=0,E=0;E<U.length-1;E++){var A=U[E],t=U[E+1],K=t.x-A.x,L=t.y-A.y,d=Math.sqrt(K*K+L*L);if(J+=d,J>e){s=E;break}}var $=U[s];r+=Math.atan2(P.y-$.y,P.x-$.x)}b&&(P=S(w,P.x-w.x,P.y-w.y,b)),n.$5e(f,P,v,c[O],r)}}l+=N.getFlowElementSpace(_[O]),O++}))}f.restore()}},Lm=G._80o;G._80o=function(G){Lm.call(this,G);var c=this,I=c._data,u=c.gv;I.s(Z)&&u.$7e!=P&&W.call(c,G)};var qg=A._80o;A._80o=function(R){qg.call(this,R);var o=this,a=o._data,N=o.gv;a.s(Z)&&N.$7e!=P&&W.call(o,R)};var Ql=G._79o,Mn=A._79o,vg=function(){var J=this,c=J._data,_=c.s(x),u=!1,X=P;if(J._6I||(u=!0),X=c instanceof r.Edge?Ql.call(J):Mn.call(J),c.s(Z)&&u){var m=c.s(H),U=c.s(C);U&&m>_&&(_=m),_>0&&E.grow(X,Math.ceil(_/2)),R(J)}return!c.s(Z)&&u&&(c[Y]=c[s]=c[a]=J[$]=P),X};A._79o=vg,G._79o=vg,b.$5e=function(b,O,c,J,N){var j=this,t=j._data,u=j.gv,l=t.s(d),r=t.s(z),B=t.s(T),D=t.s(C),g=u.$8e,s=t.s(n);if(g==P&&(g=u.$8e={}),b.beginPath(),s!=P){var K=E.getImage(s),v=c/2;b.translate(O.x,O.y),b.rotate(N),b.translate(-O.x,-O.y),E.drawImage(b,K,O.x-v,O.y-v,c,c,t),b.translate(O.x,O.y),b.rotate(-N),b.translate(-O.x,-O.y)}else if(u.__flowBatch){var x=u.__flowBatchGroup;x||(x=u.__flowBatchGroup={});var I=[O.x,O.y,c/2];x[l]?x[l].push(I):x[l]=[I]}else b.fillStyle=l,b.arc(O.x,O.y,c/2,0,2*Math.PI,!0),b.fill();if(D){var U=22,$=U+"_"+r+"_"+B,S=g[$];if(S==P){var H=document.createElement("canvas");m.setCanvas(H,U,U);var R=H.getContext("2d"),G=U/2,A=G,Q=G;m.translateAndScale(R,0,0,1),R.beginPath();var F=R.createRadialGradient(A,Q,0,A,A,G);F.addColorStop(0,r),F.addColorStop(1,B),R.fillStyle=F,R.arc(A,Q,G,0,2*Math.PI,!0),R.fill(),S=g[$]=H}var v=J/2;E.drawImage(b,S,O.x-v,O.y-v,J,J,t)}},l.$9e=function(){var M=this,E=M.dm().$3e;M._24I,E.forEach(function(n){M._24I[n._id]=n}),M.iv()};var Nn=D.prepareRemove;D.prepareRemove=function(Z){Nn.call(this,Z);var H=Z._dataModel,n=H.$3e;if(n)for(var m=n.length,b=0;m>b;b++)if(n[b]===Z){n.splice(b,1);break}},l.setFlowInterval=function(I){var c=this,S=c.$11e;c.$11e=I,c.fp("flowInterval",S,I),c.$7e!=P&&(clearInterval(c.$7e),delete c.$7e,c.enableFlow(I))},l.getFlowInterval=function(){return this.$11e},l.enableFlow=function(w){var p=this,V=p.dm(),Z=V.$3e;p.$7e==P&&(Z.forEach(function(i){var K=p.getDataUI(i);R(K)}),p.$7e=setInterval(function(){V.$3e.forEach(function(v){U(p.getDataUI(v))}),p.$9e()},w||p.$11e||50))},l.disableFlow=function(){var x=this;clearInterval(x.$7e),delete x.$7e;var o=x.dm().$3e;o&&x.$9e()};var Rf=function(){this.__flowBatchGroup={}},wi=function(O){var H=this.__flowBatchGroup;if(H){O.save();for(var P in H){O.fillStyle=P,O.beginPath();var y=H[P];y.forEach(function(P){O.moveTo(P[0],P[1]),O.arc(P[0],P[1],P[2],0,2*Math.PI,!0)}),O.fill()}O.restore()}};l.setFlowBatch=function(g){var l=this;!!l.__flowBatch!=!!g&&(l.__flowBatch=g,g?(l.addBottomPainter(Rf),l.addTopPainter(wi)):(l.removeBottomPainter(Rf),l.removeTopPainter(wi)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);