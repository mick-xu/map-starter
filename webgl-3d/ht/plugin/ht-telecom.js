!function(F,n){"use strict";var t=ht.AlarmSeverity=function(u,c,t,M,U){this.value=u,this.name=c,this.nickName=t,this.color=M,this.displayName=U};ht.Default.def("ht.AlarmSeverity",n,{toString:function(){return this.displayName||this.name}}),function(){t.severities=new ht.List,t._vm={},t._nm={},t._cp=function(D,h){if(D&&h){var A=D.value-h.value;return A>0?1:0>A?-1:0}return D&&!h?1:!D&&h?-1:0},t.each=function(Z,J){t.severities.each(Z,J)},t.getSortFunction=function(){return t._cp},t.setSortFunction=function(f){t._cp=f,t.severities.sort(f)},t.add=function(A,p,N,P,j){var $=new t(A,p,N,P,j);return t._vm[A]=$,t._nm[p]=$,t.severities.add($),t.severities.sort(t._cp),$},t.remove=function(B){var K=t._nm[B];return K&&(delete t._nm[B],delete t._vm[K.value],t.severities.remove(K)),K},t.CRITICAL=t.add(500,"Critical","C","#FF0000"),t.MAJOR=t.add(400,"Major","M","#FFA000"),t.MINOR=t.add(300,"Minor","m","#FFFF00"),t.WARNING=t.add(200,"Warning","W","#00FFFF"),t.INDETERMINATE=t.add(100,"Indeterminate","N","#C800FF"),t.CLEARED=t.add(0,"Cleared","R","#00FF00"),t.isClearedAlarmSeverity=function(j){return j?0===j.value:!1},t.getByName=function(E){return t._nm[E]},t.getByValue=function(e){return t._vm[e]},t.clear=function(){t.severities.clear(),t._vm={},t._nm={}},t.compare=function(O,v){return t._cp(O,v)}}();var w=ht.AlarmState=function(V){this._d=V,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",n,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var v=null;for(var V in this._am)V=t.getByName(V),t.isClearedAlarmSeverity(V)||0!==this.getAcknowledgedAlarmCount(V)&&(v=v?t.compare(v,V)>0?v:V:V);this._haa=v},_c2:function(){var a=null;for(var O in this._nm)O=t.getByName(O),t.isClearedAlarmSeverity(O)||0!==this.getNewAlarmCount(O)&&(a=a?t.compare(a,O)>0?a:O:O);this._hna=a},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var I in this._nm)if(I=t.getByName(I),!t.isClearedAlarmSeverity(I)&&0!==this.getNewAlarmCount(I)&&t.compare(this._hna,I)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var N=this._haa,B=this._hna,p=this._ps;this._hoa=N,t.compare(B,this._hoa)>0&&(this._hoa=B),t.compare(p,this._hoa)>0&&(this._hoa=p)},_c5:function(){var h=this._haa,B=this._hna;this._hta=h,t.compare(B,this._hta)>0&&(this._hta=B)},increaseAcknowledgedAlarm:function(I,Q){if(0!==Q){Q=Q||1;var g=this._am[I.name]||0;g+=Q,this._am[I.name]=g,this._f()}},increaseNewAlarm:function(T,u){if(0!==u){u=u||1;var A=this._nm[T.name]||0;A+=u,this._nm[T.name]=A,this._f()}},decreaseAcknowledgedAlarm:function(t,b){if(0!==b){b||(b=1);var p=this._am[t.name]||0;if(p-=b,0>p)throw"Alarm count can not be negative";this._am[t.name]=p,this._f()}},decreaseNewAlarm:function(H,h){if(0!==h){h||(h=1);var K=this._nm[H.name]||0;if(K-=h,0>K)throw"Alarm count can not be negative";this._nm[H.name]=K,this._f()}},acknowledgeAlarm:function(L){this.decreaseNewAlarm(L,1),this.increaseAcknowledgedAlarm(L,1)},acknowledgeAllAlarms:function(o){if(o){var A=this.getNewAlarmCount(o);this.decreaseNewAlarm(o,A),this.increaseAcknowledgedAlarm(o,A)}else for(var O in this._nm)this.acknowledgeAllAlarms(t.getByName(O))},_c6:function(){this._aac=0;for(var I in this._am)I=t.getByName(I),this._aac+=this.getAcknowledgedAlarmCount(I)},getAcknowledgedAlarmCount:function(p){return p?this._am[p.name]||0:this._aac},getAlarmCount:function(U){return this.getAcknowledgedAlarmCount(U)+this.getNewAlarmCount(U)},_c7:function(){this._nac=0;for(var n in this._nm)this._nac+=this.getNewAlarmCount(t.getByName(n))},getNewAlarmCount:function(E){return E?this._nm[E.name]||0:this._nac},setNewAlarmCount:function(O,w){this._nm[O.name]=w,this._f()},removeAllNewAlarms:function(H){H?delete this._nm[H]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(d,j){this._am[d.name]=j,this._f()},removeAllAcknowledgedAlarms:function(f){f?delete this._am[f.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(k){if(this._ep||(k=null),this._ps!==k){var B=this._ps;this._ps=k,this._f(),this._d.fp("propagateSeverity",B,k)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(j){var O=this._ep;this._ep=j,this._d.fp("enablePropagation",O,j)&&(j||this.setPropagateSeverity(null))}});var $=ht.AlarmStatePropagator=function(Z){this._dataModel=Z,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",n,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(X){this._enable!==X&&(this._enable=X,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(F){this.propagate(F)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(p){p.data&&this.propagate(p.data)},handleDataPropertyChange:function(M){if("alarmState"===M.property||"enablePropagation"===M.property)this.propagate(M.data);else if("parent"===M.property){var F=M.oldValue;F&&this.propagate(F),this.propagate(M.data)}},propagate:function(E){E&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(E),this._isPropagating=!1)},propagateToTop:function(s){for(this.propagateToParent(null,s);s&&s.getParent();)this.propagateToParent(s,s.getParent()),s=s.getParent()},propagateToParent:function(W,x){var i=null;x.getChildren().each(function(n){var j=n.getAlarmState().getHighestOverallAlarmSeverity();t.compare(j,i)>0&&(i=j)}),x.getAlarmState().setPropagateSeverity(i)}}),ht.AlarmStateStatistics=function(v){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(v)},ht.Default.def("ht.AlarmStateStatistics",n,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(l){var q=this._dataModel;q!==l&&(q&&(q.umd(this.handleDataPropertyChange,this),q.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=l,this.reset(),l.md(this.handleDataPropertyChange,this),l.mm(this.handleDataModelChange,this),this.fp("dataModel",q,l))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(R){"alarmState"===R.property&&(this.increase(R.data),this.fireAlarmStateChange())},handleDataModelChange:function(g){"add"===g.kind?(this.increase(g.data),this.fireAlarmStateChange()):"remove"===g.kind?(this.decrease(g.data),this.fireAlarmStateChange()):"clear"===g.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,t.each(function(U){var j=this.getSumInfo(U);this.sumAcked+=j.ackedCount,this.sumNew+=j.newCount,this.sumTotal+=j.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(t){if(!t)return this.sumNew;var N=this.getSumInfo(t);return N.newCount},getAcknowledgedAlarmCount:function(f){if(!f)return this.sumAcked;var c=this.getSumInfo(f);return c.ackedCount},getTotalAlarmCount:function(r){if(!r)return this.sumTotal;var C=this.getSumInfo(r);return C.totalCount},getSumInfo:function(U){var f=this.severtiyMap[U.name];return f||(f={},f.newCount=0,f.ackedCount=0,f.totalCount=0,this.severtiyMap[U.name]=f),f},decrease:function(I){var F=this.dataMap[I.getId()];F&&(delete this.dataMap[I.getId()],t.each(function(g){var S=F[g.name],G=this.getSumInfo(g);G.newCount=G.newCount-S.newCount,G.ackedCount=G.ackedCount-S.ackedCount,G.totalCount=G.totalCount-S.totalCount},this))},increase:function(M){if(this.decrease(M),!this._filterFunc||this._filterFunc(M)){var Y={},B=M.getAlarmState();this.dataMap[M.getId()]=Y,t.each(function(w){var D={};D.newCount=B.getNewAlarmCount(w),D.ackedCount=B.getAcknowledgedAlarmCount(w),D.totalCount=B.getAlarmCount(w),Y[w.name]=D;var Z=this.getSumInfo(w);Z.newCount=Z.newCount+D.newCount,Z.ackedCount=Z.ackedCount+D.ackedCount,Z.totalCount=Z.totalCount+D.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(c){var k=this._filterFunc;this._filterFunc=c,this.reset(),this.fp("filterFunc",k,c)},getFilterFunc:function(){return this._filterFunc}});var C=ht.Data.prototype;C.getAlarmState=function(){return this._alarmState||(this._alarmState=new w(this))},C=ht.DataModel.prototype,C.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},C.setEnableAlarmStatePropagator=function(l){l!=this.isEnableAlarmStatePropagator()&&(l?(this._alarmStatePropagator=new $(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},C=ht.graph.GraphView.prototype,C.getNote2=function(L){var W=L.getAlarmState().getHighestNewAlarmSeverity();if(W){var E=L.getAlarmState().getNewAlarmCount(W)+W.nickName;return L.getAlarmState().hasLessSevereNewAlarms()&&(E+="+"),E}return L.s("note2")},C.getNote2Background=function(Q){var b=Q.getAlarmState().getHighestNewAlarmSeverity();return b?b.color:Q.s("note2.background")},C.getBodyColor=function(Y){var i=Y.getAlarmState().getHighestNativeAlarmSeverity();return i?i.color:Y.s("body.color")},C.getBorderColor=function(I){var s=I.getAlarmState().getPropagateSeverity();return s?s.color:I.s("border.color")},C=ht.widget.TreeView.prototype,C.getBorderColor=function(T){var Q=T.getAlarmState().getPropagateSeverity();return Q?Q.color:T.s("border.color")},C.getIcon=function(q){return q.getIcon()?"__alarmIcon__":null},C=ht.widget.TreeTableView.prototype,C.getBorderColor=function(x){var X=x.getAlarmState().getPropagateSeverity();return X?X.color:x.s("border.color")},C.getIcon=function(f){return f.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(J){return J.getIcon()}},color:{func:function(n){var e=n.getAlarmState().getHighestNativeAlarmSeverity();return e?e.color:n.s("body.color")}},rect:[0,0,16,16]}]});var M=ht.Style;M["note2.expanded"]=!0,M["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);