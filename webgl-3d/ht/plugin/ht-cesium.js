!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e=e||self).ht=e.ht||{},e.ht.cesium={}))}(this,function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e,t,n){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}for(var T=((0,eval)("this")||(0,eval)("global")||(0,eval)("window")).ht,C=Cesium.CustomEntity,A=Cesium.DrawCommand,u=Cesium.Cartesian3,E=Cesium.Matrix4,x=Cesium.Pass,I=Cesium.RenderState,M=Cesium.BlendingState,c=ht.Math.Quaternion,r=ht.Math.Euler,f=ht.Math.Vector3,h=ht.Math.Matrix4,s=["xyz","xzy","yxz","yzx","zxy","zyx"],d={},m=0,y=s.length;m<y;++m){var p=s[m],w=(p[2]+p[1]+p[0]).toUpperCase();d[p]=w}var g=function(){function g(e,t,n){var i,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,o=4<arguments.length&&void 0!==arguments[4]&&arguments[4];if(v(this,g),(i=l(this,k(g).call(this,r))).e=e,i.t=t,i.n=n,i.i=o,i.r=!1,i.o=new c(0,0,0,1),i.u=new f(0,0,0),i.l=new f(1,1,1),i.c=void 0,i.f=[],i.v=new f(0,0,0),i.h=!0,i.d=!0,i.m=0,i.p=new h,i.g=new h,i.k=0,i.ignoreInCesiumPick=!1,n){var a=n.p3(),s=n.r3(),u=n.getScale3d();i.r=n.s("shape3d.transparent"),_.set(s[0],s[1],s[2],d[n.getRotationMode()]),i.o.setFromEuler(_),i.u.set(a[0],a[1],a[2]),i.l.set(u[0],u[1],u[2])}return i}return a(g,C),o(g,[{key:"getData",value:function(){return this.n}},{key:"getPosition",value:function(e){e=e||new f(0,0,0);var t=this.u;return f.prototype.copy.call(e,t),e}},{key:"setPosition",value:function(e){var t=this.u;return e&&!B(t,e)&&(t.copy(e),R(this)),this}},{key:"getScale",value:function(e){e=e||new f(1,1,1);var t=this.l;return f.prototype.copy.call(e,t),e}},{key:"setScale",value:function(e){var t=this.l;if(e&&!B(t,e)){if(0<this.f.length&&(e.x!==e.y||e.x!==e.z))throw new RangeError("The scale.x and scale.y as parent node must be equal.");t.copy(e),R(this)}return this}},{key:"getRotate",value:function(e){e=e||new c;var t=this.o;return c.prototype.copy.call(e,t),e}},{key:"getRotationX",value:function(){return this.v.x}},{key:"getRotationY",value:function(){return this.v.y}},{key:"getRotationZ",value:function(){return this.v.z}},{key:"setRotate",value:function(e){var t=this.o;return e&&!function(e,t){return e[j]===t[j]&&e[q]===t[q]&&e[U]===t[U]&&e[Q]===t[Q]}(t,e)&&(t.copy(e),R(this)),this}},{key:"setRotationX",value:function(e){this.v.x=e,this.setRotate((new ht.Math.Quaternion).setFromAxisAngle({x:1,y:0,z:0},e))}},{key:"setRotationY",value:function(e){this.v.y=e,this.setRotate((new ht.Math.Quaternion).setFromAxisAngle({x:0,y:1,z:0},e))}},{key:"setRotationZ",value:function(e){this.v.z=e,this.setRotate((new ht.Math.Quaternion).setFromAxisAngle({x:0,y:0,z:1},e))}},{key:"setTransformWithGISDegrees",value:function(e,t,n,i,r,o){return ne(this,e,t,2<arguments.length&&void 0!==n?n:0,3<arguments.length&&void 0!==i?i:1,4<arguments.length?r:void 0,5<arguments.length?o:void 0),this}},{key:"getParent",value:function(){return this.c}},{key:"setParent",value:function(e){if(this.c!==e){for(var t=e;t;){if(t===this)throw new RangeError("Cyclic dependence.");t=t.c}if(e&&(e.l.x!==e.l.y||e.l.z!=e.l.z))throw new RangeError("The scale.x and scale.y as parent node must be equal.");var n=this.c;if(this.c=void 0,n){var i=n.f,r=i.indexOf(this);0<=r&&i.split(r,1)}return e&&(this.c=e).f.push(this),F(this),this}}},{key:"forEachChildren",value:function(e,t){for(var n=this.f,i=0,r=n.length;i<r;++i)e.call(t,n[i],i,this)}},{key:"some",value:function(e,t){for(var n=this.f,i=0,r=n.length;i<r;++i)if(e.call(t,n[i],i,this))return!0;return!1}},{key:"every",value:function(e,t){for(var n=this.f,i=0,r=n.length;i<r;++i)if(!e.call(t,n[i],i,this))return!1;return!0}},{key:"setMatrix",value:function(e){this.g.fromArray(e.el),e=this.g;var t=new h;return t.extractRotation(e),this.l.setFromMatrixScale(e),this.u.setFromMatrixPosition(e),_.setFromRotationMatrix(t),this.o.setFromEuler(_),this.h=!1,F(this),this}},{key:"getMatrix",value:function(e){e=e||new h;var t=N(this);return e.fromArray(t.el),e}},{key:"getComputedMatrix",value:function(e){e=e||new h;var t=D(this);return e.fromArray(t.el),e}},{key:"getComputedMatrixVersion",value:function(){return this.k}},{key:"updateNodeTransform",value:function(){}},{key:"updateAndRender",value:function(e,t,n,i,r){var o=this.c,a=this.n;if(a){!function e(t,n,i){if(i){if(t.n){var r=D(t);!n&&t.k===t.m||(t.k=t.m,P(t.n,r,t.l))}}else{var o,a=[t],s=0,u=0;for(s=0;s<a.length;++s)for(e(a[s],n,!0),o=a[s].f,u=0;u<o.length;++u)a.push(o[u])}return this}(this,r,!0);var s=void 0,u=a&&a.testRenderLayer("GIS")&&a.s("3d.visible");if(u)if(this.b=!1,s=this.t.getData3dUI(a).getBoundingBox()){s=s.clone();var l=a.s3();s.min.x*=l[0],s.min.y*=l[1],s.min.z*=l[2],s.max.x*=l[0],s.max.y*=l[1],s.max.z*=l[2]}s?(E.unpack(this.p.el,0,O),this.boundingVolume=C.createBoundingVolumeFromMinMax(s.min,s.max,O)):this.boundingVolume=void 0,b(k(g.prototype),"updateAndRender",this).call(this,e,t,n,i,o);var c=this.t,f=n.passes,v=this.screenSpaceError;if(i.picking=f.pick&&!f.customOnly,u&&this.boundingVolume&&this.visibility){var h=a.s("GIS.maxScreenError"),d=a.s("GIS.minScreenError");if((null==h||v<=h)&&(null==d||d<=v)){var m=function(e){if(!e.boundingVolume)return;var t;e.C||(e.C=[function(e){var t=new A;return t.owner=e,t.isCustomDrawCommand=!0,t.pass=x.TRANSLUCENT,t.renderState=I.fromCache({cull:{enabled:!1},depthTest:{enabled:!0},depthMask:!1,blending:W}),t}(e),function(e){var t=new A;return t.owner=e,t.isCustomDrawCommand=!0,t.pass=x.OPAQUE,t.renderState=I.fromCache({cull:{enabled:!1},depthTest:{enabled:!0},depthMask:!0,blending:M.DISABLED}),t}(e)]);t=e.i?e.C:e.r?[e.C[0]]:[e.C[1]];for(var n=0;n<t.length;n++)oe(t[n],e);return t}(this);if(m)for(var y=0;y<m.length;y++){var p=m[y],w=c.getFrameState().defaultProgram;w&&p.customShaderProgram!==w&&(p.customShaderProgram=w,p.shaderProgram=t.wrapNativeProgram(w)),c.isSelectable(a)&&!this.ignoreInCesiumPick?(p.pickId="vec4(gl_FragColor.r, gl_FragColor.g, gl_FragColor.b, (gl_FragColor.a * 255.0 - 128.0)/255.0)",this.T||(this.T=t.createPickId({id:this,primitive:a}))):p.pickId=void 0,n.commandList.push(p)}}}}else b(k(g.prototype),"updateAndRender",this).call(this,e,t,n,i,o)}},{key:"customExecDrawCommand",value:function(e,t,n,i,r){var o=this.t.getFrameState(),a=o.renderState,s=t.pass===x.TRANSLUCENT;a.program=e.getNativeProgram(i),o.savePV(),o.setPV(E.toArray(n.frustum.projectionMatrix),E.toArray(e.uniformState.view)),o.setUniforms(),n.picking&&this.T?o.drawData(this.n,s,function(e){return(255*e.red&255)<<16|(255*e.green&255)<<8|(255*e.blue&255)<<0|(255*e.alpha&255)<<24}(this.T.color)):o.drawData(this.n,s),o.restorePV()}},{key:"multiPart",get:function(){return this.i},set:function(e){this.i!==!!e&&(this.i=!!e,this.g3d&&this.g3d.iv())}}]),g}(),_=new r,O=new E;var L,G,z,S,P=(L=new r,G=new f,z=new f,S=new h,function(e,t,n){var i=e;S.fromArray(t.el),S.scale({x:1/n.x,y:1/n.y,z:1/n.z}),G.setFromMatrixScale(S),S.extractRotation(S),L.setFromRotationMatrix(S,d[i.getRotationMode()]),z.setFromMatrixPosition(t),i.p3(z.x,z.y,z.z),i.r3(L.x,L.y,L.z),i.setScale3d(G.x*n.x,G.y*n.y,G.z*n.z)});function N(e){var t=e.g;return e.h&&(t.makeRotationFromQuaternion(e.o),t.scale(e.l),t.setPosition(e.u),e.h=!1),t}function D(e){var t=e.p;if(e.h||e.d){for(var n,i,r=[e],o=e.c;o;){if(!o.h&&!o.d){o=void 0;break}r.push(o),o=o.c}r.reverse();for(var a=0,s=r.length;a<s;++a)n=N(o=r[a]),t=o.p,o.m++,o.c?(i=o.c.p,t.multiplyMatrices(i,n)):t.fromArray(n.el),o.d=!1}return t}function R(e){e.h||(e.h=!0,e.d||function(e){var t=e.f.length;for(;t--;)F(e.f[t])}(e))}function F(e){for(var t,n,i,r,o=[e];void 0!==(t=o.pop());)if(!t.d&&(t.d=!0,!t.h))for(n=o.length,o.length=i=n+t.f.length,r=0;n<i;n++,r++)o[n]=t.f[r]}function B(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}var j="_x",q="_y",U="_z",Q="_w",W={enabled:!0,equationRgb:Cesium.BlendEquation.ADD,equationAlpha:Cesium.BlendEquation.ADD,functionSourceRgb:Cesium.BlendFunction.SOURCE_ALPHA,functionSourceAlpha:Cesium.BlendFunction.ONE,functionDestinationRgb:Cesium.BlendFunction.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:Cesium.BlendFunction.ONE_MINUS_SOURCE_ALPHA};var V,H,Y,Z,J,X,K,$,ee,te,ne=(V=new f(0,0,-1),H=new u,Y=new f,Z=new f(0,1,0),J=new f,X=new f,K=new f,$=new c,ee=new c,function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,o=5<arguments.length?arguments[5]:void 0,a=6<arguments.length?arguments[6]:void 0;u.fromDegrees(t,n,i,a,H),o=o||V,Y.set(r||1,r||1,r||1),e.setPosition(H),e.setScale(Y),J.copy(H).normalize(),$.setFromUnitVectors(Z,J),X.copy(o).normalize(),X.applyQuaternion($).normalize(),K.crossVectors(J,Z),K.crossVectors(K,J).normalize();var s=K.angleTo(X);return ee.setFromAxisAngle(J,s),ee.multiplyQuaternions(ee,$),e.setRotate(ee),e}),ie=((te=[])[Cesium.WebGLConstants.VERTEX_SHADER]="vertexShaderSource",te[Cesium.WebGLConstants.FRAGMENT_SHADER]="fragmentShaderSource","_boundingSphere"),re="_orientedBoundingBox";function oe(e,t){var n=t.boundingVolume;e.boundingVolume=n[ie],e.orientedBoundingBox=n[re]}Cesium.CustomScene,Cesium.CustomViewer,Cesium.RequestScheduler,Cesium.TaskProcessor;var ae=Cesium.Cartesian3,se=ht.Math.Vector3,ue=function(){function n(e,t){v(this,n),this.t=e,this.A=t,this.I=t.camera,this.M,this._=!1,this.O=!1,this.t.mp(this.htCameraChanged,this),this.htToCesium(),t.preUpdate.addEventListener(function(){this.beforeCesiumUpdate()},this),t.postUpdate.addEventListener(function(){this.endCesiumUpdate()},this),this.I.viewChanged.addEventListener(this.cesiumCameraChanged,this)}return o(n,[{key:"beforeCesiumUpdate",value:function(){this._&&(this.htToCesium(),this._=!1)}},{key:"endCesiumUpdate",value:function(){this.O&&(this.cesiumToHT(),this.O=!1)}},{key:"htCameraChanged",value:function(e){if(this.L||!le[e.property])return!0;this._=!0}},{key:"cesiumCameraChanged",value:function(){if(this.G)return!0;this.O=!0}},{key:"htToCesium",value:function(){var e=this.t,t=this.I;this.G=!0;try{var n=e.getEye(),i=e.getCenter(),r=e.getUp(),o=new ae(0,0,0),a=new ae(i[0],i[1],i[2]);t.lookAtTransform(Cesium.Matrix4.IDENTITY),ae.fromElements(n[0],n[1],n[2],t.position),ae.subtract(a,t.position,o),ae.normalize(o,o),ae.fromElements(r[0],r[1],r[2],t.up),ae.clone(o,t.direction),ae.cross(t.up,t.direction,t.up),ae.cross(t.direction,t.up,t.up),t.frustum.fov=function(e,t){return e<=1?t:2*Math.atan(e*Math.tan(.5*t))}(e.getAspect(),e.getFovy()),t.frustum.aspectRatio=e.getAspect(),ae.cross(t.direction,t.up,t.right),ae.cross(t.right,t.direction,t.up),this.M=t.viewMatrix}finally{this.G=!1}}},{key:"cesiumToHT",value:function(){var e=this.t,t=this.I;this.L=!0;try{e.setAspect(t.frustum.aspectRatio),e.setFovy(t.frustum.fovy);var n=t.transform,i=t.inverseViewMatrix;e.setEye(i[12],i[13],i[14]),e.setUp(i[4],i[5],i[6]);var r=new se(n[12]-i[12],n[13]-i[13],n[14]-i[14]);if(r.equals(t.direction))e.setCenter(n[12],n[13],n[14]);else{var o=new se(i[12],i[13],i[14]);o.addScaledVector(t.direction,r.length()),e.setCenter(o.x,o.y,o.z)}}finally{this.L=!1}}}]),n}();var le={eye:!0,center:!0,up:!0,aspect:!0,fovy:!0},ce=(Cesium.CustomScene,Cesium.CustomViewer),fe=(Cesium.RequestScheduler,Cesium.TaskProcessor,Cesium.Cartesian3,function(){function f(e,t,n){v(this,f),n=function(){for(var e=Object(arguments[0]),t=1;t<arguments.length;t++){var n=arguments[t];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}({},ve,n);var i=t.getGL(),r=i.getContextAttributes(),o=t.getCanvas(),a={allowTextureFilterAnisotropic:n.allowTextureFilterAnisotropic,requestWebgl2:"createSampler"in i,webgl:r},s=n.creditContainer||document.createElement("div"),u=new Cesium.CustomContext(o,a);n.creditContainer=s,n.canvas=o,n.context=u,n.eventTarget=t.getView();var l=this;l.layer=e,l.t=t,l.S=o,l.P=u;var c=function(e,t){var n=e.t;t.scene3DOnly=!0,t.requestRenderMode=!0,t.sceneRenderCallback=function(){e.N&&e.t&&e.t.iv()};var i=new ce(n.getView(),t);i.cesiumWidget.screenSpaceEventHandler.effective=!1,i.viewerElement.addEventListener("pointerdown",function(e){i.cesiumWidget.container.contains(e.target)||e.stopPropagation()});var r=(e.D=i).scene;return r.screenSpaceCameraController.ignoreInputs(),r.constrainedAxis=Cesium.Cartesian3.UNIT_Z,r.logarithmicDepthBuffer=!1,r.renderError.addEventListener(function(e,t){console.log("A Cesium error occurred while rendering."),console.error(t)}),r}(this,n);l.A=c,l.N=!0,function(i,e){var t=T.Default.cameraPriority,n=e.priority;void 0===n&&(n=.5*(t.skybox+t.main));i.t.addCamera({priority:n,ignoreInPick:!1,render:function(e,t,n){!function(e,t,n,i){if(!e.N||!e.D.canRenderScene())return;e.R._&&e.D.cesiumWidget.render();var r=t.getParameter(t.FRAMEBUFFER_BINDING);r!==e.F&&(e.F=r,e.B=null==r?void 0:new Cesium.CustomFramebuffer(e.P));t.clearColor(0,0,0,1),e.P.resetToCurr();var o=e.A;o.renderTarget=e.B,o.externalColorClear=!1,i.picking?o.renderCustomOnly():o.execRender();o.renderTarget=void 0,i.renderState.syncLoss()}(i,e,0,n)}})}(this,n),l.R=new ue(l.t,c),l.j=!1,l.q=[]}return o(f,[{key:"createNode",value:function(e,t){return new g(this,this.t,e,t)}},{key:"useCesiumInputHandler",value:function(){this.j||(this.j=!0,this.q=this.t.getInteractors().toArray(),this.t.setInteractors([]),this.D.cesiumWidget.screenSpaceEventHandler.effective=!0,this.A.screenSpaceCameraController.catchInputs(),document.oncontextmenu=function(e){e.preventDefault()})}},{key:"useG3DInputHandler",value:function(){this.j&&(document.oncontextmenu=null,this.j=!1,this.t.setInteractors(this.q),this.q=[],this.D.cesiumWidget.screenSpaceEventHandler.effective=!1,this.A.screenSpaceCameraController.ignoreInputs())}},{key:"graph3dView",get:function(){return this.t}},{key:"cesiumScene",get:function(){return this.A}},{key:"cesiumViewer",get:function(){return this.D}},{key:"effective",get:function(){return this.N},set:function(e){!!e!=!!this.N&&(this.N=e,this.t&&this.t.iv())}}]),f}());var ve={allowTextureFilterAnisotropic:!0},he=function(){function e(){v(this,e)}return o(e,null,[{key:"isNil",value:function(e){return null===e}},{key:"isNumber",value:function(e){return(e instanceof Number||"number"==typeof e)&&!isNaN(e)}},{key:"isInteger",value:function(e){return(0|e)===e}},{key:"isObject",value:function(e){return"object"===t(e)&&!!e}},{key:"isString",value:function(e){return e instanceof String||"string"==typeof e}},{key:"isBoolean",value:function(e){return e instanceof Boolean||"boolean"==typeof e}},{key:"isDate",value:function(e){return e instanceof Date}},{key:"isArray",value:function(e){return e instanceof Array}},{key:"isFunction",value:function(e){return e instanceof Function||"function"==typeof e}},{key:"isURL",value:function(e){if(!e)return!1;var t=e.slice(0,6);return"http:/"===t||"https:"===t||"file:/"===t}},{key:"isMap",value:function(e){return e instanceof T.cesium.Map}},{key:"isScene",value:function(e){return e instanceof T.cesium.Scene}},{key:"isNode",value:function(e){return e instanceof T.cesium.Node}},{key:"valueType",value:function(e){return 0==arguments.length?"0":null===e?"null":void 0===e&&0<arguments.length?"undefined":e instanceof T.cesium.Map?"ht.cesium.Map":e instanceof T.cesium.Node?"ht.cesium.Node":e instanceof T.cesium.Scene?"ht.cesium.Scene":e instanceof Function?"function":e instanceof Array?"array":e instanceof Date?"date":e instanceof Number||"number"==typeof e?"number":e instanceof String||"string"==typeof e?"string":e instanceof Boolean||"boolean"==typeof e?"boolean":Object.prototype.toString.call(e)}}]),e}(),de=Cesium,me=ht.Math.Vector4,ye=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,pe=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i,we=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,ge=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i,ke=function(){function c(){v(this,c)}return o(c,null,[{key:"color",value:function(e){var t=c.cssColorStr2RGBA(e);return new de.Color(t.red,t.green,t.blue,t.alpha)}},{key:"cssColorStr2RGBA",value:function(e){var t=new me,n=de.Color[e.toUpperCase()];if(n)return n;var i=ye.exec(e);return null!==i?(t.x=parseInt(i[1],16)/15,t.y=parseInt(i[2],16)/15,t.z=parseInt(i[3],16)/15,t.w=1,{red:t.x,green:t.y,blue:t.z,alpha:t.w}):null!==(i=pe.exec(e))?(t.x=parseInt(i[1],16)/255,t.y=parseInt(i[2],16)/255,t.z=parseInt(i[3],16)/255,t.w=1,{red:t.x,green:t.y,blue:t.z,alpha:t.w}):null!==(i=we.exec(e))?(t.x=parseFloat(i[1])/("%"===i[1].substr(-1)?100:255),t.y=parseFloat(i[2])/("%"===i[2].substr(-1)?100:255),t.z=parseFloat(i[3])/("%"===i[3].substr(-1)?100:255),t.w=parseFloat(i[4]?i[4]:"1.0"),{red:t.x,green:t.y,blue:t.z,alpha:t.w}):null!==(i=ge.exec(e))?c.hsl2rgb(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,parseFloat(i[4]||"1.0")):t=void 0}},{key:"rgba2CSSColorStr",value:function(e){var t=c.floatToByte(e.red),n=c.floatToByte(e.green),i=c.floatToByte(e.blue);return 1===e.alpha?"rgb("+t+","+n+","+i+")":"rgba("+t+","+n+","+i+","+e.alpha+")"}},{key:"hsl2rgb",value:function(e,t,n,i){e=(e||0)%1,i=i||1;var r=n=n||0,o=n,a=n;if(0!==(t=t||0)){var s,u=2*n-(s=n<.5?n*(1+t):n+t-n*t);r=c.hue2rgb(u,s,e+1/3),o=c.hue2rgb(u,s,e),a=c.hue2rgb(u,s,e-1/3)}var l=new me(r,o,a,i);return{red:l.x,green:l.y,blue:l.z,alpha:l.w}}},{key:"hue2rgb",value:function(e,t,n){return n<0&&(n+=1),1<n&&(n-=1),6*n<1?e+6*(t-e)*n:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}},{key:"clone",value:function(e){if(!e)throw new Error("The color is undefined.");var t=new me(e.red,e.green,e.blue,e.alpha||"1.0");return{red:t.x,green:t.y,blue:t.z,alpha:t.w}}},{key:"byte2Float",value:function(e){return e/255}},{key:"float2Byte",value:function(e){return 1===e?255:256*e|0}}]),c}(),be=Cesium,Ce=function(){function e(){v(this,e)}return o(e,null,[{key:"coordinate2World",value:function(e,t,n,i){var r=2<arguments.length&&void 0!==n?n:0,o=3<arguments.length&&void 0!==i?i:be.Ellipsoid.WGS84,a=new be.Cartographic.fromDegrees(e,t,r);return o.cartographicToCartesian(a)}},{key:"world2Coordinate",value:function(e,t,n,i){var r=0<arguments.length&&void 0!==e?e:0,o=1<arguments.length&&void 0!==t?t:0,a=2<arguments.length&&void 0!==n?n:0,s=3<arguments.length&&void 0!==i?i:be.Ellipsoid.WGS84;s=s||be.Ellipsoid.WGS84;var u=new be.WebMercatorProjection(s),l=new be.Cartesian3(r,o,a),c=u.unproject(l);return{longitude:be.Math.toDegrees(c.longitude),latitude:be.Math.toDegrees(c.latitude),alt:c.height}}}]),e}(),Te=he.isNumber,Ae=he.isString,Ee=he.isBoolean,xe=he.isArray,Ie=he.isFunction,Me=he.isMap,_e=he.isNode,Oe=ke.color,Le=Ce;function Ge(){return("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx-"+(new Date).valueOf()).replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function ze(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)e[i]=n[i]}return e}function Se(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;if(v(this,Se),!Cesium)throw new Error("Invalid when create the bing map.");if(Cesium.BingMapsApi.defaultKey=t||"AhAwfTL3tFcA7gegl2AclV7XteHi_n11QeSXmv_vcJUbri05KSqYu7qj9TEK910P",void 0===Cesium.BingMapsApi.getKey)throw new Error("The key is not exit.");var n=e.style?e.style:"AERIAL",i=Object.assign({url:je.BING_IMAGE,mapStyle:Cesium.BingMapsStyle[n],credit:new Cesium.Credit("Bing 地图")},e);return new Cesium.BingMapsImageryProvider(i)}function Pe(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(v(this,Pe),!Cesium)throw new Error("Invalid when create the google map.");if(!e)throw new Error("The type of map is undefined.");var r=Object.assign({url:je[e],layer:t||"baseImagery",credit:new Cesium.Credit(n||"Map"),maximumLevel:18},i);return new Cesium.UrlTemplateImageryProvider(r)}function Ne(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(v(this,Ne),!Cesium)throw new Error("Invalid when create the amap.");if(!e)throw new Error("The type of map is undefined.");var r=Object.assign({url:je[e],layer:t||"baseImagery",credit:new Cesium.Credit(n||"Map"),subdomains:["1","2","3","4"],maximumLevel:18},i);return new Cesium.UrlTemplateImageryProvider(r)}function De(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(v(this,De),!Cesium)throw new Error("Invalid when create the tdt map.");if(!e)throw new Error("The type of map is undefined.");var r=i.key?i.key:"df11cd123596c5fa51542a40ad3f826e",o=Object.assign({url:je[e]+"&tk="+r,layer:t||"baseImagery",credit:new Cesium.Credit(n||"Map"),style:"default",format:"tiles",subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],maximumLevel:18},i);return new Cesium.WebMapTileServiceImageryProvider(o)}function Re(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(v(this,Re),!Cesium)throw new Error("Invalid when create the arcgis map.");var t=e.url?e.url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",n=Object.assign({url:t,credit:new Cesium.Credit("ArcGIS 地图服务")},e);return new Cesium.ArcGisMapServerImageryProvider(n)}function Fe(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(v(this,Fe),!Cesium)throw new Error("Invalid when create the geoq map.");if(!e)throw new Error("The type of map is undefined.");var r=Object.assign({url:je[e],layer:t||"baseImagery",format:"image/png",credit:new Cesium.Credit(n||"Map")},i);return new Cesium.UrlTemplateImageryProvider(r)}function Be(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(v(this,Be),!Cesium)throw new Error("Invalid when create the arcgis map.");var t=e.key?e.key:"pk.eyJ1IjoiZ2xlbnJpdmVyIiwiYSI6ImNqMDBuM3F6dDA1ZTMycHFsMTFwb3cyYjQifQ.Zjd6aHjhtkR18QmFhRxutA",n=e.mapId?e.mapId:"mapbox.streets",i=Object.assign({mapId:n,accessToken:t},e);return new Cesium.MapboxImageryProvider(i)}var je={BING_IMAGE:"https://dev.virtualearth.net",GOOGLE_MAP:"http://www.google.cn/maps/vt?lyrs=m&x={x}&y={y}&z={z}",GOOGLE_IMAGE:"http://www.google.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}",GOOGLE_IMAGE_ANNOTATION:"http://www.google.cn/maps/vt?lyrs=y&x={x}&y={y}&z={z}",TDT_MAP:"http://{s}.tianditu.com/vec_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=vec&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles",TDT_IMAGE:"http://{s}.tianditu.com/img_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles",GAODE_MAP:"http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",GAODE_IMAGE:"http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",GEOQ_MAP:"http://map.geoq.cn/arcgis/rest/services/ChinaOnlineCommunity/MapServer/tile/{z}/{y}/{x}",GEOQ_PURPLISHBLUEMAP:"http://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",GEOQ_GRAYMAP:"http://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetGray/MapServer/tile/{z}/{y}/{x}",GEOQ_WARMMAP:"http://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetWarm/MapServer/tile/{z}/{y}/{x}",TERRAIN:"https://assets.agi.com/stk-terrain/v1/tilesets/world/tiles",GOOGLE_TERRAIN:"http://www.google.cn/maps/vt?lyrs=t&x={x}&y={y}&z={z}",GOOGLE_ANNOTATION_TERRAIN:"http://www.google.cn/maps/vt?lyrs=p&x={x}&y={y}&z={z}",TDT_ANNOTATION:"http://{s}.tianditu.com/cia_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=cia&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default.jpg",GAODE_ANNOTATION:"http://webst0{s}.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}",GOOGLE_ANNOTATION:"http://www.google.cn/maps/vt?lyrs=h&x={x}&y={y}&z={z}"},qe={BImage:"Bing 影像地图",GMap:"谷歌街道地图",GImage:"谷歌影像（无注记）",GAImage:"谷歌影像（有注记）",AMap:"高德街道地图",AImage:"高德影像",TdtMap:"天地图街道地图",TdtImage:"天地图影像",BDMap:"百度地图街道图",MapboxMap:"Mapbox 地图",ArcGISMap:"ArcGIS 地图",GqMap:"智图街道地图",GqbMap:"智图街道地图（深蓝）",GqgMap:"智图街道地图（灰色）",GqwMap:"智图街道地图（暖色）"},Ue=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(v(this,t),!Cesium)throw new Error("Invalid when create the arcgis map.");this.U="http://api{s}.map.bdimg.com/customimage/tile?&x={x}&y={y}&z={z}&scale=1&customid={style}",this.Q=256,this.W=256,this.V=18,this.H=new Cesium.WebMercatorTilingScheme({rectangleSouthwestInMeters:new Cesium.Cartesian2(-33554054,-33746824),rectangleNortheastInMeters:new Cesium.Cartesian2(33554054,33746824)}),this.Y=this.H.rectangle,this.Z=void 0,this.J=e.style||"normal"}return o(t,[{key:"getTileCredits",value:function(e,t,n){}},{key:"requestImage",value:function(e,t,n){if(!this.ready)throw new Cesium.DeveloperError("requestImage must not be called before the imagery provider is ready.");var i=this.H.getNumberOfXTilesAtLevel(n),r=this.H.getNumberOfYTilesAtLevel(n),o=this.U.replace("{x}",e-i/2).replace("{y}",r/2-t-1).replace("{z}",n).replace("{s}",1).replace("{style}",this.J);return Cesium.ImageryProvider.loadImage(this,o)}},{key:"url",get:function(){return this.U}},{key:"token",get:function(){return this.X}},{key:"tileWidth",get:function(){if(!this.ready)throw new Cesium.DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this.Q}},{key:"tileHeight",get:function(){if(!this.ready)throw new Cesium.DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this.W}},{key:"maximumLevel",get:function(){if(!this.ready)throw new Cesium.DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return this.V}},{key:"minimumLevel",get:function(){if(!this.ready)throw new Cesium.DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0}},{key:"tilingScheme",get:function(){if(!this.ready)throw new Cesium.DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this.H}},{key:"rectangle",get:function(){if(!this.ready)throw new Cesium.DeveloperError("rectangle must not be called before the imagery provider is ready.");return this.Y}},{key:"ready",get:function(){return!!this.U}},{key:"credit",get:function(){return this.Z}}]),t}(),Qe=new(function(){function e(){v(this,e)}return o(e,[{key:"createBaseMap",value:function(e,t){var n=null;switch(e){case"BImage":n=new Se(t);break;case"GMap":n=new Pe("GOOGLE_MAP","googleMapLayer","谷歌地图地图服务",t);break;case"GImage":n=new Pe("GOOGLE_IMAGE","googleImageLayer","谷歌地图影像服务",t);break;case"GAImage":n=new Pe("GOOGLE_IMAGE_ANNOTATION","googleImageLayer","谷歌地图影像服务",t);break;case"AMap":n=new Ne("GAODE_MAP","gaodeMapLayer","高德地图地图服务",t);break;case"AImage":n=new Ne("GAODE_IMAGE","gaodeImageLayer","高德地图影像服务",t);break;case"AAnnotation":n=new Ne("GAODE_ANNOTATION","gaodeAnnotationLayer","高德地图注记服务",t);break;case"TdtMap":n=new De("TDT_MAP","tdtMapLayer","天地图地图服务",t);break;case"TdtImage":n=new De("TDT_IMAGE","tdtMapLayer","天地图影像服务",t);break;case"TdtAnnotation":n=new De("TDT_ANNOTATION","tdtAnnotationLayer","天地图注记服务",t);break;case"ArcGISMap":n=new Re(t);break;case"GqMap":n=new Fe("GEOQ_MAP","geoqMapLayer","智图基础地图服务",t);break;case"GqbMap":n=new Fe("GEOQ_PURPLISHBLUEMAP","geoqBlueMapLayer","智图蓝色地图服务",t);break;case"GqgMap":n=new Fe("GEOQ_GRAYMAP","geoqGrayMapLayer","智图灰色地图服务",t);break;case"GqwMap":n=new Fe("GEOQ_WARMMAP","geoqWarmMapLayer","智图暖色调地图服务",t);break;case"MapboxMap":n=new Be(t);break;case"BDMap":n=new Ue(t)}return n}}]),e}()),We=Cesium,Ve=function(){function e(){v(this,e)}return o(e,null,[{key:"flyTo4HT",value:function(e,t,n,i){var r=2<arguments.length&&void 0!==n?n:[0,0,0],o=3<arguments.length&&void 0!==i?i:{};if(!We)throw new Error("The cesium is not undefined.");if(!e)throw new Error("The graph3dView is undefined.");if(!t)throw new Error("The camera position is undefined.");o=ze({duration:2e3},o);var a=[];if(a[0]<-180||180<a[0]||a[1]<-90||90<a[1])a[0]=t[0]?t[0]:0,a[1]=t[1]?t[1]:0,a[2]=t[2]?t[2]:1e5;else{var s=We.Cartesian3.fromDegrees(a[0],a[1],a[2]);a=[s.x,s.y,s.z]}e.moveCamera(a,r,o)}},{key:"flyTo4Cesium",value:function(e,t,n,i,r,o){if(!We)throw new Error("The cesium is not undefined.");if(!e)throw new Error("The cesium viewer is undefined.");if(!t)throw new Error("The camera position is undefined.");var a=We.Cartesian3.fromDegrees(t[0],t[1],t[2]);a.z+=t[2]?t[2]:1500;var s=ze({destination:a,orientation:xe(n)?{heading:We.Math.toRadians(n[0]),pitch:We.Math.toRadians(n[1]),roll:n[2]}:{heading:We.Math.toRadians(n.heading),pitch:We.Math.toRadians(n.pitch),roll:n.roll},complete:function(){Ie(r)&&r()},cancle:function(){Ie(o)&&o()}},i);e.camera.flyTo(s)}},{key:"flyToTarget",value:function(e,t,n){if(!We)throw new Error("The cesium.js is not imported.");if(!e)throw new Error("The cesium viewer is undefined.");if(!t)throw new Error("The target is undefined.");n=ze({offset:{heading:We.Math.toRadians(145),pitch:We.Math.toRadians(-20),roll:0}},n||{}),e.flyTo(t,n)}},{key:"setView",value:function(e,t,n){if(!We)throw new Error("The cesium.js is not imported.");if(!e)throw new Error("The cesium viewer is undefined.");if(!t)throw new Error("The camera position is undefined.");var i=void 0,r=[],o=xe(t)?t.length:0;if(o<2||4<o)throw new Error("The camera position is error.");o<4?(r[0]=t[0]?t[0]:0,r[1]=t[1]?t[1]:0,r[2]=t[2]?t[2]:1500,i=We.Cartesian3.fromDegrees(r[0],r[1],r[2])):4===o&&(i=We.Rectangle.fromDegrees(r[0],r[1],r[2],r[3]));var a={heading:We.Math.toRadians(145),pitch:We.Math.toRadians(-20),roll:0};if(a=ze(a,n||{}),!i)throw new Error("The destination is undefined.");e.camera.setView({destination:i,orientation:a})}},{key:"lookAt",value:function(e,t,n){if(!We)throw new Error("The cesium.js is not imported.");if(!e)throw new Error("The cesium viewer is undefined.");if(!t)throw new Error("The target center is undefined.");var i=void 0;if(2!==(xe(t)?t.length:0))throw new Error("The target center is error.");i=We.Cartesian3.fromDegrees(t[0],t[1]);var r=n.heading?n.heading:We.Math.toRadians(50),o=n.pitch?n.pitch:We.Math.toRadians(-20),a=n.range?n.range:5e3;e.camera.lookAt(i,new We.HeadingPitchRange(r,o,a))}}]),e}(),He=function(){function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};v(this,i),(e=l(this,k(i).call(this))).K=void 0,e.$=void 0,e.ee={},e.te=void 0,e.ne=void 0,e.ie="Scene",e.re=[],e.oe=[],e.ee=ze({},t),e.ne=t.scene;var n=t.lnglat;if(n)if(xe(n))e.te=n;else{if(!n.lng||!n.lat)throw new Error("The data type is error.");e.te=[n.lng,n.lat]}return e}return a(i,T.Data),o(i,[{key:"addToMap",value:function(r,o){if(r&&Me(r)){var a=this,e=r.graph3dView,s=r.cesiumPlugin,u=r.cesiumScene,t=a.property,l=a.center,n=a.sceneJson;if(!l||l.length<0)throw new Error("The latitude and longitude of node is unddefined.");if(!n)throw new Error("The scene of options is undefined.");var c=t.id||Ge(),f=t.scale||1,v=t.height||0,h=t.nodeRender||"GIS",d=t.isLocation||!1,m=t.locationDelay||10,y=t.locationHeight||1e3,p=t.locationOffset||[0,0],w=t.locationOrientation||[0,-90,0];a.$=r,a.K=c;var g={x:1,y:0,z:1};if(g=xe(t.orientation)?{x:t.orientation[0]||1,y:t.orientation[1]||0,z:t.orientation[2]||1}:t.orientation,s){var k=s.createNode(),b={},C=new T.List,i=u.customEntities&&xe(u.customEntities)?u.customEntities.length:0;u.customEntities.push(k),a.re.push(i),T.Default.getClassMap()["ht.Node"]=T.cesium.Node,e.deserialize(n,function(e,t,n,i){i&&(i.forEach(function(e,t){e.s("shape3d.alwaysOnTop")||(e.setRenderLayer(h),a.oe.push(e));var n=s.createNode(e,1);_e(e)&&(e.info4Scene={id:c+"-"+t,map:r,cesiumNode:n}),n.setParent(k),n.multiPart=!0,C.add(n),u.customEntities.push(n),a.re.push(u.customEntities.length-1)}),b={id:c,type:"Scene",data:C,parentNode:k},r.htNodeDatas=b,k.setTransformWithGISDegrees(l[0],l[1],v,f,g),d?setTimeout(function(){r.flyTo({position:[l[0]+p[0],l[1]+p[1],y],orientation:w},function(){Ie(o)&&o(b)})},m):Ie(o)&&o(b))})}}}},{key:"remove",value:function(){var e=this,t=e.map;if(t){var n=t.graph3dView,i=t.cesiumScene,r=e.uuid,o=t.htNodeDatas;if(o.hasOwnProperty(r)){delete o[r],t.htNodeDatas=o;var a=0;e.re.forEach(function(e){i.customEntities.splice(e-a,1),a++}),e.oe.forEach(function(e){n.dm().remove(e)}),e.re=[],e.oe=[]}}}},{key:"uuid",get:function(){return this.K}},{key:"map",get:function(){return this.$}},{key:"property",get:function(){return this.ee}},{key:"dataType",get:function(){return this.ie}},{key:"center",get:function(){return this.te},set:function(e){var t=[];if(xe(e))t=e;else{if(!e.lng||!e.lat)throw new Error("The data type is error.");t=[e.lng,e.lat]}this.te=t}},{key:"sceneJson",get:function(){return this.ne},set:function(e){this.ne=e}}]),i}(),Ye=Cesium,Ze=function(){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return v(this,n),(e=l(this,k(n).call(this))).K=void 0,e.$=void 0,e.ae=void 0,e.ie="3DTiles",e.se=void 0,e.ee=ze({},t),e}return a(n,ht.Data),o(n,[{key:"addToMap",value:function(a,s){if(a&&Me(a)){var u=this,l=a.graph3dView,e=a.cesiumScene,c=u.property,t=a.htNodeDatas;if(!c.url)throw new Error("The url of 3ditls is unddefined.");var f=c.id||Ge(),n=c.url,i=c.show||!0,v=c.isLocation||!1,h=c.locationDelay||1e3,r=c.cesiumOptions||{};if(u.$=a,u.K=f,t&&t.hasOwnProperty(f))throw new Error('The "'+f+'" node already exists.');var o=ze({url:n,show:i,maximumScreenSpaceError:2,maximumNumberOfLoadedTiles:1e3},r),d=new Ye.Cesium3DTileset(o),m=u.se=e.primitives.add(d);d.readyPromise.then(function(e){if(c.isAdjust){var t=Cesium.Cartographic.fromCartesian(d.boundingSphere.center),n=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,t.height),i=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,c.height),r=Cesium.Cartesian3.subtract(i,n,new Cesium.Cartesian3);d.modelMatrix=Cesium.Matrix4.fromTranslation(r)}v&&setTimeout(function(){a.flyToTarget(m)},h),l.dm().add(u);var o={id:f,type:u.dataType,data:m,parentNode:null};a.htNodeDatas=o,Ie(s)&&s(m,d)})}}},{key:"remove",value:function(){var e=this.$;if(e){var t=this.se,n=this.uuid,i=e.graph3dView,r=e.cesiumScene,o=e.htNodeDatas;if(!t||!r.primitives.contains(t))throw new Error("The layer is not added on the map.");o&&o[n]&&delete o[n],e.htNodeDatas=o,r.primitives.remove(t),i.dm().remove(this)}}},{key:"uuid",get:function(){return this.K}},{key:"map",get:function(){return this.$}},{key:"property",get:function(){return this.ee}},{key:"dataType",get:function(){return this.ie}}]),n}(),Je=void 0,Xe=void 0,Ke=void 0,$e=void 0,et=void 0,tt=function(){function n(e,t){v(this,n),Xe=(e=e).cesiumScene,Ke=t,this.ue=void 0}return o(n,[{key:"clickEvent",value:function(n){clearTimeout($e),$e=setTimeout(function(){var e,t=Xe.pick(n);(e=t?t.primitive:void 0)?Ie(Ke)&&Ke({kind:"clickData",data:e,mouseEvent:n}):Ie(Ke)&&Ke({kind:"clickBackground",mouseEvent:n})},200)}},{key:"onClickEvent",value:function(i){clearTimeout(et),et=setTimeout(function(){var e=void 0,t=Xe.pick(i);if((e=t?t.primitive:void 0)&&e.s("interactive")){var n=e.s("onClick");Ie(n)&&n(i,e,Je)}},200)}},{key:"doubleClickEvent",value:function(e){clearTimeout($e);var t,n=Xe.pick(e);(t=n?n.primitive:void 0)?Ie(Ke)&&Ke({kind:"doubleClickData",data:t,mouseEvent:e}):Ie(Ke)&&Ke({kind:"doubleClickBackground",mouseEvent:e})}},{key:"onDoubleClickEvent",value:function(e){clearTimeout(et);var t=null,n=Xe.pick(e);if((t=n?n.primitive:void 0)&&t.s("interactive")){var i=t.s("onDoubleClick");Ie(i)&&i(e,t,Je)}}},{key:"down",value:function(e){var t,n=Xe.pick(e);(t=n?n.primitive:void 0)?Ie(Ke)&&Ke({kind:"onDown",data:t,mouseEvent:e}):Ie(Ke)&&Ke({kind:"onBackgroundDown",mouseEvent:e})}},{key:"onDown",value:function(e){var t=void 0,n=Xe.pick(e);if((t=n?n.primitive:void 0)&&t.s("interactive")){var i=t.s("onDown");Ie(i)&&i(e,t,Je)}}},{key:"up",value:function(e){var t,n=Xe.pick(e);(t=n?n.primitive:void 0)?Ie(Ke)&&Ke({kind:"onUp",data:t,mouseEvent:e}):Ie(Ke)&&Ke({kind:"onBackgroundUp",mouseEvent:e})}},{key:"onUp",value:function(e){var t=null,n=Xe.pick(e);if((t=n?n.primitive:void 0)&&t.s("interactive")){var i=t.s("onUp");Ie(i)&&i(e,t,Je)}}},{key:"move",value:function(e){var t,n=Xe.pick(e);(t=n?n.primitive:void 0)?Ie(Ke)&&Ke({kind:"onMove",data:t,mouseEvent:e}):Ie(Ke)&&Ke({kind:"onMove",mouseEvent:e})}},{key:"onMove",value:function(e){var t=null,n=Xe.pick(e);if((t=n?n.primitive:void 0)&&t.s("interactive")){var i=t.s("onMove");Ie(i)&&i(e,t,Je)}}},{key:"enter",value:function(e){var t,n=Xe.pick(e);(t=n?n.primitive:void 0)?Ie(Ke)&&Ke({kind:"onEnter",data:t,mouseEvent:e}):Ie(Ke)&&Ke({kind:"onEnter",mouseEvent:e})}},{key:"onEnter",value:function(e){var t=null,n=Xe.pick(e);if((t=n?n.primitive:void 0)&&t.s("interactive")){var i=t.s("onEnter");Ie(i)&&i(e,t,Je)}}},{key:"leave",value:function(e){var t,n=Xe.pick(e);(t=n?n.primitive:void 0)?Ie(Ke)&&Ke({kind:"onLeave",data:t,mouseEvent:e}):Ie(Ke)&&Ke({kind:"onLeave",mouseEvent:e})}},{key:"onLeave",value:function(e){var t=null,n=Xe.pick(e);if((t=n?n.primitive:void 0)&&t.s("interactive")){var i=t.s("onLeave");Ie(i)&&i(e,t,Je)}}},{key:"wheel",value:function(e){Ie(Ke)&&Ke({kind:"wheel",mouseEvent:e})}},{key:"onMove",value:function(e){var t=null,n=Xe.pick(e);if(t=n?n.primitive:void 0,!this.ue||!t||this.ue.uuid!==t.uuid){if(this.ue){var i=this.ue.s("onLeave");Ie(i)&&i(e,this.ue,Je),this.ue=void 0}if(t&&t.s("interactive")){var r=(this.ue=t).s("onEnter");Ie(r)&&r(e,t,Je)}}}}]),n}(),nt=Cesium,it=new nt.Clock,rt=new nt.GeographicProjection,ot=nt.CameraEventType,at=ot.WHEEL,st=ot.PINCH,ut=ot.RIGHT_DRAG,lt=nt.ScreenSpaceEventType.LEFT_DOUBLE_CLICK,ct=nt.JulianDate.fromIso8601("2017-07-11T16:00:00Z"),ft=nt.Color.BLACK,vt={contextOptions:{webgl:{alpha:!1}},clock:it,orderIndependentTranslucency:!1,animation:!1,baseLayerPicker:!1,fullscreenButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!0,timeline:!1,navigationHelpButton:!1,scene3DOnly:!0,vrButton:!1,showRenderLoopErrors:!1,shadows:!1,imageryProvider:!1,mapProjection:rt,requestRenderMode:!0,shouldAnimate:!0},dt=new T.DataModel;dt.a("map.layer",5),dt.a("map.terrain",void 0),dt.a("map.baseLayer",void 0),dt.a("map.home",{lnglat:[123.48,23.67],height:12e6,heading:0,pitch:-90,roll:0}),dt.a("map.effect",{enableLighting:!1,enableFog:!1,alpha:1,brightness:1,contrast:1,saturation:1,hue:1}),dt.a("camera.angle",Math.PI/10),dt.a("camera.orientation",{heading:145,pitch:-20,roll:0}),dt.a("camera.animation",{duration:5});var mt=function(){function n(e){v(this,n);var t=new T.graph3d.Graph3dView(dt,{requestWebGL2:!1});this.t=t,this.le=t.dm(),this.ce=dt,this.fe=void 0,this.ve=2e5,this.he=!1,this.de=!1,this.me=void 0,this.ye=!0,e?Ae(e)?t.addToDOM(document.getElementById(e)):t.addToDOM(e):t.addToDOM()}return o(n,[{key:"getClampHeightByLngLat",value:function(e,s){var t=this.cesiumScene,u=t.globe.ellipsoid,n=[];if(xe(e))n=e;else{if(!e.lng||!e.lat)throw new Error("The data type is error.");n=[e.lng,e.lat]}null!==n?t.clampToHeightMostDetailed(nt.Cartesian3.fromDegreesArray(n)).then(function(e){var t={},n=e[0],i=new nt.Cartesian3(n.x,n.y,n.z),r=u.cartesianToCartographic(i),o=nt.Math.toDegrees(r.latitude),a=nt.Math.toDegrees(r.longitude);t.worldCoordinate=n,t.lnglat=[a,o],t.clampHeight=r.height,Ie(s)&&s(t)}):Ie(s)&&s(null)}},{key:"getBaseMapByLevel",value:function(e){var t=this.cesiumScene,n=void 0;t&&(n=t.imageryLayers.get(parseInt(e)));return n}},{key:"getDataByUUID",value:function(t){var n=void 0;return t&&this.dm.getDatas().forEach(function(e){e.uuid===t&&(n=e)}),n}},{key:"add",value:function(e,t){if(e){if(!Ie(e.addToMap))throw new Error("The data is not allowed to be superimposed on the map.");e.addToMap(this,t)}}},{key:"createEarth",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{},i=this.graph3dView;nt.FeatureDetection.setForbidPointerEvents(!0),n=ze(vt,n),this.fe=new fe("GIS",i,n),this.setBaseMap(),function(e){var n=arguments,t=e.graph3dView,i=e.cesiumPlugin,r=e.cesiumScene,o=e.cesiumViewer;i.useCesiumInputHandler(),r.screenSpaceCameraController.zoomEventTypes=[at,st],r.screenSpaceCameraController.tiltEventTypes=[st,ut],r.highDynamicRange=!1,r.globe.depthTestAgainstTerrain=!0,r.globe.enableLighting=!0,r.skyBox.show=!1,r.sun.show=!1,r.moon.show=!1,r.backgroundColor=new nt.Color(0,0,0,.01),r.globe.baseColor=ft,o.cesiumWidget.screenSpaceEventHandler.removeInputAction(lt),o.clock.currentTime=ct,o.viewerElement.style.pointerEvents="none",navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)&&(r.fog.enable=!1,r.skyAtmosphere.show=!1,r.fxaa=!1);document.addEventListener("keydown",function(e){var t=e||window.event||n.callee.caller.arguments[0];if(t)switch(t.keyCode){case 82:o.cesiumInspector&&(o.cesiumInspector.viewModel.wireframe=!o.cesiumInspector.viewModel.wireframe);break;case 70:o.scene.debugShowFramesPerSecond=!o.scene.debugShowFramesPerSecond}}),t.setFar(1e10),t.setNear(50),t.setMovableFunc(function(){return!1}),t.setEye([7220118,5009993,17316177]),t.getCanvas().style.pointerEvents="";var a=e.dm.a("map.effect"),s=r.imageryLayers;a.enableLighting=r.globe.enableLighting,a.enableFog=r.fog.enabled,a.alpha=s.get(0).alpha,a.brightness=s.get(0).brightness,a.contrast=s.get(0).contrast,a.saturation=s.get(0).saturation,a.hue=s.get(0).hue,e.dm.a("map.effect",a);var u=new nt.CustomCamera(r),l=!1;r.camera.viewChanged.addEventListener(function(){l||(yt(r.camera,e.ce.a("camera.angle"))?nt.CustomCamera.clone(r.camera,u):(l=!0,nt.CustomCamera.clone(u,r.camera),l=!1))},r),e.initialCorrect&&setTimeout(function(){o.camera.flyTo({destination:nt.Cartesian3.fromDegrees(123.48,23.67,14e6),orientation:{heading:nt.Math.toRadians(0),pitch:nt.Math.toRadians(-90),roll:0}})},50);!function(e){var t=e.graph3dView.getView(),n=new tt(e);t.addEventListener("click",n.onClickEvent),t.addEventListener("dblclick",n.onDoubleClickEvent),t.addEventListener("mousedown",n.onDown),t.addEventListener("mouseup",n.onUp),t.addEventListener("mouseover",n.onMove),t.addEventListener("mousemove",n.onMove)}(e)}(this),Ie(e)&&e(i)}},{key:"createLayer",value:function(e){var t=0<arguments.length&&void 0!==e?e:{};if(!t.type)throw new Error("The type of layer is undefined");var n=void 0;switch(t.type){case"mapLayer":n=void 0;break;case"htLayer":n=new He(this,t);break;case"3dtileLayer":n=new Ze(this,t);break;default:n=void 0}return n}},{key:"setHomeView",value:function(e,t){var n=0<arguments.length&&void 0!==e?e:{},i=1<arguments.length?t:void 0,r=this.cesiumViewer;r&&(n=ze(this.ce.a("map.home"),n),this.ce.a("map.home",n),Ve.flyTo4Cesium(r,[n.lnglat[0],n.lnglat[1],n.height],{heading:n.heading,pitch:n.pitch,roll:n.roll},{},i))}},{key:"setBaseMap",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{},i=this.cesiumScene,r=this.ce.a("map.baseLayer");if(i){var o=i.imageryLayers;if(r===(e=e||"GImage"))return;if(!qe.hasOwnProperty(e))throw new Error("The 【"+e+"】is not built-in map.");if(!("BImage"!==e&&"TdtMap"!==e&&"TdtImage"!==e&&"MapboxMap"!==e||this.he||n.key))throw new Error("The key of options is undefined.");this.ce.a("map.baseLayer",e);var a;if(null!==(a=Qe.createBaseMap(e,n))){var s=o.get(0);o.remove(s),o.addImageryProvider(a,0)}}}},{key:"setEarthRotation",value:function(e){var t=0<arguments.length&&void 0!==e&&e;t?this.me||(this.me=function(e,t){function n(){var e=Date.now(),t=(e-o)/1e3;o=e,i.camera.rotate(nt.Cartesian3.UNIT_Z,-.1*t)}var i=e.cesiumScene,r=e.cesiumViewer,o=Date.now();if(t)return r.clock.onTick.addEventListener(n),n;return}(this,t)):this.me&&(this.cesiumViewer.clock.onTick.removeEventListener(this.me),this.me=void 0)}},{key:"flyTo",value:function(e,t,n){var i=0<arguments.length&&void 0!==e?e:{},r=1<arguments.length?t:void 0,o=2<arguments.length?n:void 0;if(!i.position)throw new Error("The camera position is undefined.");var a=this.cesiumViewer,s=i.position,u=i.orientation||this.defalutCameraOrientation,l=i.animation||this.defaultCameraAnimation;a&&Ve.flyTo4Cesium(a,s,u,l,r,o)}},{key:"moveCamera",value:function(e,t,n){if(!e)throw new Error("The camera position is undefined.");var i=this.graph3dView;Ve.flyTo4HT(i,e,t,n)}},{key:"flyToTarget",value:function(e,t){if(!e)throw new Error("The target is undefined.");var n=this.cesiumViewer;n&&Ve.flyToTarget(n,e,t)}},{key:"setView",value:function(e,t){if(!e)throw new Error("The camera position is undefined.");var n=this.cesiumViewer;n&&Ve.setView(n,e,t)}},{key:"lookAt",value:function(e,t){if(!e)throw new Error("The target center is undefined.");var n=this.cesiumViewer;n&&Ve.lookAt(n,e,t)}},{key:"zoomIn",value:function(e){Te(e)&&this.graph3dView.zoomIn(e)}},{key:"zoomOut",value:function(e){Te(e)&&this.graph3dView.zoomOut(e)}},{key:"loadTerrain",value:function(e,t){var n=0<arguments.length&&void 0!==e?e:{},i=1<arguments.length&&void 0!==t&&t,r=this.cesiumScene,o=this.dm,a=o.a("map.terrain");if(r){var s=n.waterMask||!1,u=n.vertexNormals||!1,l=n.url||"https://www.supermapol.com/realspace/services/3D-stk_terrain/rest/realspace/datas/info/data/path";a=a||new nt.CesiumTerrainProvider({url:l,requestWaterMask:s,requestVertexNormals:u}),i?(n.cesiumIonToken&&(nt.Ion.defaultAccessToken="HT"===n.cesiumIonToken?"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzNDhhYmQxOC1mYzMwLTRhYmEtOTI5Ny1iNGExNTQ3ZTZhODkiLCJpZCI6NTQ1NCwic2NvcGVzIjpbImFzciIsImdjIl0sImlhdCI6MTU0MzM3Mzc0NH0.RU6ynAZcwQvdfygt_N_j2rb2lpsuyyROzdaLQg0emAg":n.cesiumIonToken,a=new nt.CesiumTerrainProvider({url:nt.IonResource.fromAssetId(3956),requestWaterMask:s,requestVertexNormals:u})),r.terrainProvider=a,o.a("map.terrain",a)):(r.terrainProvider=new nt.EllipsoidTerrainProvider,o.a("map.terrain",void 0))}}},{key:"loadOnlineMap",value:function(e,t){if(!e)throw new Error("MapLayer is undefined.");var n=this.cesiumScene.imageryLayers,i=this.ce.a("map.layer");n.addImageryProvider(e,i++),this.ce.a("map.layer",i),Ie(t)&&t(e,i-1)}},{key:"loadOffLineMap",value:function(e){var t=0<arguments.length&&void 0!==e?e:{};if(!t.url)throw new Error("Invalid url when loading off-line map.");var n=this.cesiumScene;if(n){var i=n.imageryLayers;if(t.type=t.type||"zxy","single"===t.type){var r=new nt.SingleTileImageryProvider({url:t.url});i.addImageryProvider(r,2)}else if("zxy"===t.type){var o=new nt.UrlTemplateImageryProvider({url:t.url});i.addImageryProvider(o,4)}}}},{key:"addInteractorListener",value:function(e){var t=this.graph3dView.getView(),n=new tt(this,e);t.addEventListener("click",n.clickEvent),t.addEventListener("dblclick",n.doubleClickEvent),t.addEventListener("mousedown",n.down),t.addEventListener("mouseup",n.up),t.addEventListener("mouseover",n.move),t.addEventListener("mouseenter",n.enter),t.addEventListener("mouseleave",n.leave),t.addEventListener("wheel",n.wheel)}},{key:"removeInteractorListener",value:function(e){var t=this.graph3dView.getView(),n=new tt(this,e);t.removeEventListener("click",n.clickEvent),t.removeEventListener("dblclick",n.doubleClickEvent),t.removeEventListener("mousedown",n.down),t.removeEventListener("mouseup",n.up),t.removeEventListener("mouseover",n.move),t.removeEventListener("mouseenter",n.enter),t.removeEventListener("mouseleave",n.leave),t.removeEventListener("wheel",n.wheel)}},{key:"mi",value:function(e){this.addInteractorListener(e)}},{key:"umi",value:function(e){this.removeInteractorListener(e)}},{key:"addCameraListener",value:function(e){var t=this,n=t.cesiumScene,i=new nt.CustomCamera(n),r=!1;n.camera.viewChanged.addEventListener(function(){r||(yt(n.camera,t.ce.a("camera.angle"))?nt.CustomCamera.clone(n.camera,i):(r=!0,nt.CustomCamera.clone(i,n.camera),r=!1),Ie(e)&&e(t))},n)}},{key:"coordinate2World",value:function(e,t){return Le.coordinate2World(e,t)}},{key:"graph3dView",get:function(){return this.t}},{key:"mapDataModel",get:function(){return this.ce}},{key:"cesiumPlugin",get:function(){return this.fe}},{key:"cesiumScene",get:function(){return this.cesiumPlugin?this.cesiumPlugin.cesiumScene:void 0}},{key:"cesiumViewer",get:function(){return this.cesiumPlugin?this.cesiumPlugin.cesiumViewer:void 0}},{key:"onlineMap",get:function(){return qe}},{key:"dm",get:function(){return this.mapDataModel}},{key:"defalutCameraOrientation",get:function(){return this.dm.a("camera.orientation")},set:function(e){var t=0<arguments.length&&void 0!==e?e:[0,0,0];xe(t)?this.dm.a("camera.orientation",{heading:nt.Math.toRadians(t[0]),pitch:nt.Math.toRadians(t[1]),roll:nt.Math.toRadians(t[2])}):this.dm.a("camera.orientation",{heading:nt.Math.toRadians(t.heading),pitch:nt.Math.toRadians(t.pitch),roll:nt.Math.toRadians(t.roll)})}},{key:"defaultCameraAnimation",get:function(){return this.dm.a("camera.animation")},set:function(e){var t=0<arguments.length&&void 0!==e?e:{};this.dm.a("camera.animation",t)}},{key:"earthCameraLimitAngle",get:function(){return this.dm.a("camera.angle")},set:function(e){this.dm.a("camera.angle",e||Math.PI/10)}},{key:"earthVisible",get:function(){return this.cesiumPlugin.effective},set:function(e){this.cesiumPlugin&&(this.cesiumPlugin.effective=e)}},{key:"htNodeDatas",get:function(){return this.dm.a("Node.datas")},set:function(e){if(e.type){var t=this.dm.a("Node.datas");if((t=t||{}).hasOwnProperty(e.id))throw new Error('The "'+e.id+'" node already exists.');t[e.id]=e,this.dm.a("Node.datas",t)}}},{key:"htVisibleDistance",get:function(){return this.ve},set:function(e){if(!Te(e))throw new Error("The distance is illegal. The ditance should be number.");this.ve=e}},{key:"initialCorrect",get:function(){return this.ye},set:function(e){var t=!(0<arguments.length&&void 0!==e)||e;this.ye=t}},{key:"ignoreMapKey",set:function(e){this.he=!!Ee(e)&&e}},{key:"backgroundColor",set:function(e){var t=0<arguments.length&&void 0!==e?e:"black";if(this.graph3dView&&this.graph3dView.dm().setBackground(t),this.cesiumScene){var n=this.cesiumScene;n.skyBox.show=!1,n.sun.show=!1,n.moon.show=!1,n.backgroundColor=new Cesium.Color(0,0,0,.01)}}},{key:"mapEffect",set:function(e){var t=0<arguments.length&&void 0!==e?e:{},n=this.cesiumScene,i=this.ce.a("map.effect");if(n){var r=n.imageryLayers;i=Object.assign(i,t),n.globe.enableLighting=i.enableLighting,n.fog.enabled=i.enableFog;var o=r.get(0);o&&(o.alpha=i.alpha,o.brightness=i.brightness,o.contrast=i.contrast,o.saturation=i.saturation,o.hue=i.hue)}}},{key:"skyBox",set:function(e){var t=0<arguments.length&&void 0!==e?e:{},n=this.cesiumScene;n&&(t.XP||t.XN||t.YP||t.YN||t.ZP||t.ZN?n.skyBox=new nt.SkyBox({sources:{positiveX:t.XP,negativeX:t.XN,positiveY:t.YP,negativeY:t.YN,positiveZ:t.ZP,negativeZ:t.ZN},show:t.show||!0}):(n.skyBox.show=!0,n.sun.show=!0,n.moon.show=!0))}},{key:"clockTime",set:function(e){var t=0<arguments.length&&void 0!==e?e:"2017-07-11 16:00:00",n=this.cesiumViewer;if(n){var i=t.split(" ");if(2!==i.length)throw new Error("The time format is illegal.");var r=nt.JulianDate.fromIso8601(i[0]+"T"+i[1]+"Z");n.clock.currentTime=r}}}],[{key:"getVersion",value:function(){return n.version}},{key:"version",get:function(){return"ht-cesium v0.0.1"}}]),n}();function yt(e,t){return e.viewMatrix&&e.pitch<-t}var pt=T.Math.Vector3,wt=function(){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return v(this,n),(e=l(this,k(n).call(this))).K=void 0,e.$=void 0,e.pe=void 0,e.te=void 0,e.ie=void 0,e.ie=t.dataType||"Node",e.ee=ze({},t),t.lnglat&&(e.center=t.lnglat),e}return a(n,T.Node),o(n,[{key:"addToMap",value:function(e,t){if(e&&Me(e)){var n=this,i=e.graph3dView,r=e.cesiumPlugin,o=e.cesiumScene,a=n.property,s=n.center,u=e.htNodeDatas;if(!s||s.length<=0)throw new Error("The latitude and longitude of node is unddefined.");var l=a.id||Ge(),c=a.scale||1,f=a.height||0,v=a.nodeRender||"GIS",h=a.orientation;if(h=h||{x:1,y:0,z:1},n.$=e,n.K=l,n.setAnchor3d([.5,0,.5]),u&&u.hasOwnProperty(l))throw new Error('The "'+l+'" node already exists.');var d={};if(r){var m=r.createNode();i.dm().add(n),n.setRenderLayer(v);var y=r.createNode(n,1);(n.pe=y).setParent(m),y.multiPart=!0,o.customEntities.push(m),o.customEntities.push(y),d={id:l,type:n.dataType,data:y,parentNode:m},e.htNodeDatas=d,m.setTransformWithGISDegrees(s[0],s[1],f,c,h)}Ie(t)&&t(d)}}},{key:"remove",value:function(){var e=this.map;if(e){var t=e.graph3dView,n=e.cesiumScene,i=this.uuid,r=void 0,o=e.htNodeDatas;n.customEntities.forEach(function(e,t){e.getData()&&e.getData().uuid===i&&(r=t)}),r&&n.customEntities.splice(r-1,2),t.dm().remove(this),delete o[i],e.htNodeDatas=o}}},{key:"setVisibleAnimByTall",value:function(e,t){var n=0<arguments.length&&void 0!==e?e:{},i=1<arguments.length?t:void 0,r=this,o=r.getTall(),a=n.frames||30,s=n.duration||1e3;T.Default.startAnim({frames:a,duration:s,finishFunc:function(){Ie(i)&&i()},action:function(e,t){r.setTall(e*o)}})}},{key:"setVisibleAnimByElevation",value:function(e,t){var n=0<arguments.length&&void 0!==e?e:{},i=1<arguments.length?t:void 0,r=this,o=r.getPosition3d(),a=T.Default.getDistance(o,[0,0,0]),s=n.frames||30,u=n.duration||1e3,l=r.getTall()*r.getScaleTall(),c=new pt(o),f=c.clone().multiplyScalar(1-l/a);r.s("3d.visible",!1),r.setPosition3d([f.x,f.y,f.z]),T.Default.startAnim({frames:s,duration:u,finishFunc:function(){Ie(i)&&i()},action:function(e,t){r.s("3d.visible",!0);var n=new pt(r.getPosition3d()),i=c.clone().sub(n).multiplyScalar(e);n=n.add(i),r.setPosition3d([n.x,n.y,n.z])}})}},{key:"uuid",get:function(){return this.K}},{key:"map",get:function(){return this.$}},{key:"property",get:function(){return this.ee}},{key:"dataType",get:function(){return this.ie}},{key:"center",get:function(){return this.te},set:function(e){var t=[];if(xe(e))t=e;else{if(!e.lng||!e.lat)throw new Error("The data type is error.");t=[e.lng,e.lat]}this.te=t}},{key:"worldCoordinate",get:function(){return this.getPosition3d()}},{key:"cesiumNode",get:function(){return this.pe}},{key:"rotationX",get:function(){return this.cesiumNode?this.cesiumNode.getRotationX():void 0},set:function(e){this.cesiumNode&&this.cesiumNode.setRotationX(e)}},{key:"rotationY",get:function(){return this.cesiumNode?this.cesiumNode.getRotationY():void 0},set:function(e){this.cesiumNode&&this.cesiumNode.setRotationY(e)}},{key:"rotationZ",get:function(){return this.cesiumNode?this.cesiumNode.getRotationZ():void 0},set:function(e){this.cesiumNode&&this.cesiumNode.setRotationZ(e)}},{key:"info4Scene",set:function(e){this.K=e.id,this.$=e.map,this.pe=e.cesiumNode}}]),n}(),gt=Cesium,kt=function(){function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return v(this,r),(e=l(this,k(r).call(this))).K=void 0,e.$=void 0,e.n=void 0,e.we=void 0,e.ge=void 0,e.ke=void 0,e.ee=ze({size:2,color:"rgb(124,145,155)"},i||{}),e.ie=i.dataType||"Point",e.setPoints([[t,n]]),e}return a(r,T.Data),o(r,[{key:"setPoints",value:function(e,t){for(var n=1<arguments.length&&void 0!==t?t:[[1,0,0,1]],i=e.length,r=[],o=[],a=0;a<i;a++){r.push(e[a][0]),r.push(e[a][1]);var s=n[a]?n[a]:n[0];o.push(s[0]),o.push(s[1]),o.push(s[2]),o.push(s[3])}this.we=new Float64Array(r),this.ge=new Float32Array(o)}},{key:"addToMap",value:function(e,t){if(e&&Me(e)){var n=this,i=e.cesiumScene,r=n.property,o=n.we,a=n.ge,s=gt.Cartesian3.fromDegreesArray(o),u=r.id||Ge(),l=e.htNodeDatas,c=r.size||10,f=void 0,v=void 0,h=void 0;if(n.$=e,n.K=u,l&&l.hasOwnProperty(u))throw new Error('The "'+u+'" node already exists.');if(s&&2<=s.length){var d=s.length,m=[],y=[],p=[];if(a&&a.length===4*d){for(var w=0;w<d;w++)m.push(s[w].x),m.push(s[w].y),m.push(s[w].z);y=a}else for(var g=0;g<d;g++)m.push(s[g].x),m.push(s[g].y),m.push(s[g].z),y.push(0),y.push(0),y.push(1),y.push(1);for(var k=1;k<d;k++)p.push(k-1),p.push(k);f=new Float64Array(m),v=new Float32Array(y),h=new Uint16Array(p)}else{var b=gt.Cartesian3.fromDegrees(o[0],o[1],c),C=gt.Cartesian3.fromDegrees(0,0,10);f=new Float64Array([b.x,b.y,b.z,C.x,C.y,C.z]),v=new Float32Array([0,0,1,1,0,0,1,0]),h=new Uint16Array([0,1])}var T=new gt.Geometry({attributes:{position:new gt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f}),color:new gt.GeometryAttribute({componentDatatype:gt.ComponentDatatype.FLOAT,componentsPerAttribute:4,values:v})},indices:h,primitiveType:gt.PrimitiveType.POINTS,boundingSphere:gt.BoundingSphere.fromVertices(f)}),A=new gt.Appearance({renderState:{blending:gt.BlendingState.PRE_MULTIPLIED_ALPHA_BLEND,depthTest:{enabled:!0},depthMask:!0},fragmentShaderSource:"varying vec4 v_color;    void main()    {        float d = distance(gl_PointCoord, vec2(0.5,0.5));        if(d < 0.5){            gl_FragColor = v_color;        }else{            discard;        }    }    ",vertexShaderSource:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10;return"attribute vec3 position3DHigh;    attribute vec3 position3DLow;    attribute vec4 color;    varying vec4 v_color;    attribute float batchId;    void main()    {        vec4 p = czm_computePosition();        v_color =color;        p = czm_modelViewProjectionRelativeToEye * p;        gl_Position = p;        gl_PointSize="+(e=parseFloat(e)+1e-4)+";    }    "}(c)}),E=new gt.Primitive({geometryInstances:new gt.GeometryInstance({id:u,geometry:T}),appearance:A,asynchronous:!1}),x={id:u,type:n.dataType,data:E,parentNode:null};e.htNodeDatas=x,n.n=E,n.ke=i.primitives.add(E),Ie(t)&&t(x)}}},{key:"remove",value:function(){}},{key:"uuid",get:function(){return this.K}},{key:"map",get:function(){return this.$}},{key:"data",get:function(){return this.n}},{key:"property",get:function(){return this.ee}},{key:"dataType",get:function(){return this.ie}}]),r}();var bt=Cesium,Ct=function(){function e(){v(this,e)}return o(e,null,[{key:"Image",value:function(e){var t={type:"Image",uniforms:{image:0<arguments.length&&void 0!==e?e:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAC/SURBVDhPrZPRDYQgEEQpjVKuFEvhw0IoxU6QgQwMK+vdx5FsooT3GHdjCM4qZnnnHvvkYoxFi/uvIhwiRCClXFC6v5UQ1uQAsbrkHCLsbaPjFgIzQQc1yUOwu33ePGE3BQUaee2BpjhbP5YUmkAlbNzsAURfBDqJnMIyyv4JjsCCgCnIR32uZUfcJuGBOwEk6bOKhoAADh31EIq3MgFg1mgkE1BA2AoUZoo2iZ3gyqGgmMDC/xWwkfb3/eUd7A1v3kxjNW9taQAAAABJRU5ErkJggg=="}};return new bt.Material({fabric:t,translucent:!0})}},{key:"Color",value:function(e){var t={type:"Color",uniforms:{color:Oe(0<arguments.length&&void 0!==e?e:"green")}};return new bt.Material({fabric:t,translucent:!0})}},{key:"DashLine",value:function(e,t,n,i){var r=1<arguments.length&&void 0!==t?t:"rgba(0,0,0,0)",o=2<arguments.length&&void 0!==n?n:10,a=3<arguments.length&&void 0!==i?i:255,s={type:"DashType",uniforms:{color:Oe(0<arguments.length&&void 0!==e?e:"green"),gapColor:Oe(r),dashLength:o,dashPattern:a},source:"uniform vec4 color;\n uniform vec4 gapColor;\n uniform float dashLength;\n uniform float dashPattern;\n varying float v_polylineAngle;\n \n const float maskLength = 16.0;\n \n mat2 rotate(float rad) {\n     float c = cos(rad);\n     float s = sin(rad);\n     return mat2(\n         c, s,\n         -s, c\n     );\n }\n \n czm_material czm_getMaterial(czm_materialInput materialInput)\n {\n     czm_material material = czm_getDefaultMaterial(materialInput);\n \n     vec2 pos = rotate(v_polylineAngle) * gl_FragCoord.xy;\n \n     // Get the relative position within the dash from 0 to 1\n     float dashPosition = fract(pos.x / dashLength);\n     // Figure out the mask index.\n     float maskIndex = floor(dashPosition * maskLength);\n     // Test the bit mask.\n     float maskTest = floor(dashPattern / pow(2.0, maskIndex));\n     vec4 fragColor = (mod(maskTest, 2.0) < 1.0) ? gapColor : color;\n     if (fragColor.a < 0.005) {   // matches 0/255 and 1/255\n         discard;\n     }\n \n     fragColor = czm_gammaCorrect(fragColor);\n     material.emission = fragColor.rgb;\n     material.alpha = fragColor.a;\n     return material;\n }\n "};return new bt.Material({fabric:s,translucent:!0})}},{key:"ArrowLine",value:function(e){var t={type:"ArrowType",uniforms:{color:Oe(0<arguments.length&&void 0!==e?e:"green")},source:"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\nuniform vec4 color;\n\nvarying float v_width;\n\nfloat getPointOnLine(vec2 p0, vec2 p1, float x)\n{\n    float slope = (p0.y - p1.y) / (p0.x - p1.x);\n    return slope * (x - p0.x) + p0.y;\n}\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 st = materialInput.st;\n\n#ifdef GL_OES_standard_derivatives\n    float base = 1.0 - abs(fwidth(st.s)) * 10.0;\n#else\n    float base = 0.99; // 1% of the line will be the arrow head\n#endif\n\n    vec2 center = vec2(1.0, 0.5);\n    float ptOnUpperLine = getPointOnLine(vec2(base, 1.0), center, st.s);\n    float ptOnLowerLine = getPointOnLine(vec2(base, 0.0), center, st.s);\n\n    float halfWidth = 0.15;\n    float s = step(0.5 - halfWidth, st.t);\n    s *= 1.0 - step(0.5 + halfWidth, st.t);\n    s *= 1.0 - step(base, st.s);\n\n    float t = step(base, materialInput.st.s);\n    t *= 1.0 - step(ptOnUpperLine, st.t);\n    t *= step(ptOnLowerLine, st.t);\n\n    // Find the distance from the closest separator (region between two colors)\n    float dist;\n    if (st.s < base)\n    {\n        float d1 = abs(st.t - (0.5 - halfWidth));\n        float d2 = abs(st.t - (0.5 + halfWidth));\n        dist = min(d1, d2);\n    }\n    else\n    {\n        float d1 = czm_infinity;\n        if (st.t < 0.5 - halfWidth && st.t > 0.5 + halfWidth)\n        {\n            d1 = abs(st.s - base);\n        }\n        float d2 = abs(st.t - ptOnUpperLine);\n        float d3 = abs(st.t - ptOnLowerLine);\n        dist = min(min(d1, d2), d3);\n    }\n\n    vec4 outsideColor = vec4(0.0);\n    vec4 currentColor = mix(outsideColor, color, clamp(s + t, 0.0, 1.0));\n    vec4 outColor = czm_antialias(outsideColor, color, currentColor, dist);\n\n    outColor = czm_gammaCorrect(outColor);\n    material.diffuse = outColor.rgb;\n    material.alpha = outColor.a;\n    return material;\n}\n"};return new bt.Material({fabric:t,translucent:!0})}},{key:"GlowLine",value:function(e,t,n){var i=1<arguments.length&&void 0!==t?t:.25,r=2<arguments.length&&void 0!==n?n:1,o={type:"GlowType",uniforms:{color:Oe(0<arguments.length&&void 0!==e?e:"green"),glowPower:i,taperPower:r},source:"uniform vec4 color;\nuniform float glowPower;\nuniform float taperPower;\n\nvarying float v_width;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 st = materialInput.st;\n    float glow = glowPower / abs(st.t - 0.5) - (glowPower / 0.5);\n\n    if (taperPower <= 0.99999) {\n        glow *= min(1.0, taperPower / (0.5 - st.s * 0.5) - (taperPower / 0.5));\n    }\n\n    vec4 fragColor;\n    fragColor.rgb = max(vec3(glow - 1.0 + color.rgb), color.rgb);\n    fragColor.a = clamp(0.0, 1.0, glow) * color.a;\n    fragColor = czm_gammaCorrect(fragColor);\n\n    material.emission = fragColor.rgb;\n    material.alpha = fragColor.a;\n\n    return material;\n}\n"};return new bt.Material({fabric:o,translucent:!0})}},{key:"Outline",value:function(e,t,n){var i=1<arguments.length&&void 0!==t?t:"green",r=2<arguments.length&&void 0!==n?n:1,o={type:"OutlineType",uniforms:{color:Oe(0<arguments.length&&void 0!==e?e:"rgba(255,255,255,0.6)"),outlineColor:Oe(i),outlineWidth:r},source:"uniform vec4 color;\nuniform vec4 outlineColor;\nuniform float outlineWidth;\n\nvarying float v_width;\n\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n\n    vec2 st = materialInput.st;\n    float halfInteriorWidth =  0.5 * (v_width - outlineWidth) / v_width;\n    float b = step(0.5 - halfInteriorWidth, st.t);\n    b *= 1.0 - step(0.5 + halfInteriorWidth, st.t);\n\n    // Find the distance from the closest separator (region between two colors)\n    float d1 = abs(st.t - (0.5 - halfInteriorWidth));\n    float d2 = abs(st.t - (0.5 + halfInteriorWidth));\n    float dist = min(d1, d2);\n\n    vec4 currentColor = mix(outlineColor, color, b);\n    vec4 outColor = czm_antialias(outlineColor, color, currentColor, dist);\n    outColor = czm_gammaCorrect(outColor);\n\n    material.diffuse = outColor.rgb;\n    material.alpha = outColor.a;\n\n    return material;\n}\n"};return new bt.Material({fabric:o,translucent:function(e){var t=e.uniforms;return t.color.alpha<1||t.outlineColor.alpha<1}})}}]),e}(),Tt=Cesium,At=function(){function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return v(this,n),(e=l(this,k(n).call(this))).K=void 0,e.$=void 0,e.n=void 0,e.we=void 0,e.ge=void 0,e.ke=void 0,e.ee=ze({},t),e.ie=t.dataType||"Line",e.be=t.type||"CLine",e.Ce=ze({width:1,color:"blue",style:"solid"},t.lineStyle||{}),e.Te=t.clamp2Ground||!0,t.points&&e.setPoints(t.points),e}return a(n,T.Data),o(n,[{key:"setPoints",value:function(e,t){for(var n=1<arguments.length&&void 0!==t?t:[[0,0,1,1]],i=e.length,r=[],o=[],a=0;a<i;a++){r.push(e[a][0]),r.push(e[a][1]);var s=n[a]?n[a]:n[0];o.push(s[0]),o.push(s[1]),o.push(s[2]),o.push(s[3])}this.we=new Float64Array(r),this.ge=new Float32Array(o)}},{key:"addToMap",value:function(e,t){if(e&&Me(e)){var n=this,i=e.cesiumScene,r=n.property,o=n.we,a=n.ge,s=Tt.Cartesian3.fromDegreesArray(o),u=r.id||Ge(),l=e.htNodeDatas,c=n.Ce.width,f=r.loop||!1,v=void 0,h=void 0,d=void 0;if(n.$=e,n.K=u,l&&l.hasOwnProperty(u))throw new Error('The "'+u+'" node already exists.');if("CLine"===n.be){var m=void 0;if(n.Te){var y=new Tt.GroundPolylineGeometry({positions:Tt.Cartesian3.fromDegreesArray(o),loop:!!f,width:c}),p=function(){var e,t,n,i,r,o,a,s,u,l=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};switch(l.style){case"dash":t=l.color||"blue",n=l.gapColor||"rgba(0,0,0,0)",i=l.dash||10,r=l.pattern||255,e=new Tt.MaterialAppearance({material:Ct.DashLine(t,n,i,r)});break;case"arrow":t=l.color||"blue",e=new Tt.MaterialAppearance({material:Ct.ArrowLine(t)});break;case"glow":t=l.color||"blue",o=l.power||.25,a=l.taper||1,e=new Tt.MaterialAppearance({material:Ct.GlowLine(t,o,a)});break;case"outline":t=l.color||"blue",s=l.fillColor||"rgba(255,255,255,0.6)",u=l.outlineWidth||1,e=new Tt.MaterialAppearance({material:Ct.Outline(t,s,u)});break;default:t=l.color||"blue",e=new Tt.MaterialAppearance({material:Ct.Color(t)})}return e}(n.Ce);m=new Tt.GroundPolylinePrimitive({geometryInstances:new Tt.GeometryInstance({id:u,geometry:y}),appearance:p,asynchronous:!1}),n.ke=i.groundPrimitives.add(m)}else{if(s&&2<=s.length){var w=s.length,g=[],k=[],b=[];if(a&&a.length===4*w){for(var C=0;C<w;C++)g.push(s[C].x),g.push(s[C].y),g.push(s[C].z);k=a}else for(var T=0;T<w;T++)g.push(s[T].x),g.push(s[T].y),g.push(s[T].z),k.push(0),k.push(0),k.push(1),k.push(1);for(var A=0;A<w;A++)b.push(A);v=new Float64Array(g),h=new Float32Array(k),d=new Uint16Array(b)}else{var E=Tt.Cartesian3.fromDegrees(o[0],o[1],10),x=Tt.Cartesian3.fromDegrees(0,0,10);v=new Float64Array([E.x,E.y,E.z,x.x,x.y,x.z]),h=new Float32Array([0,0,1,1,0,0,1,0]),d=new Uint16Array([0,1])}var I=new Tt.Geometry({attributes:{position:new Tt.GeometryAttribute({componentDatatype:Tt.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:v}),color:new Tt.GeometryAttribute({componentDatatype:Tt.ComponentDatatype.FLOAT,componentsPerAttribute:4,values:h})},indices:d,primitiveType:Tt.PrimitiveType.LINES,boundingSphere:Tt.BoundingSphere.fromVertices(v)}),M=new Tt.Appearance({renderState:{blending:Tt.BlendingState.PRE_MULTIPLIED_ALPHA_BLEND,depthTest:{enabled:!0},depthMask:!0,lineWidth:c},fragmentShaderSource:"varying vec4 v_color;    void main()    {        gl_FragColor = v_color;    }    ",vertexShaderSource:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10;return"attribute vec3 position3DHigh;    attribute vec3 position3DLow;    attribute vec4 color;    varying vec4 v_color;    attribute float batchId;    void main()    {        vec4 p = czm_computePosition();        v_color =color;        p = czm_modelViewProjectionRelativeToEye * p;        gl_Position = p;        gl_PointSize="+(e=parseFloat(e)+1e-4)+";    }    "}()});m=new Tt.Primitive({geometryInstances:new Tt.GeometryInstance({id:u,geometry:I}),appearance:M,asynchronous:!1}),n.ke=i.primitives.add(m)}var _={id:u,type:n.dataType,data:m,parentNode:null};n.a("dataInfo",_),e.dm.add(n),Ie(t)&&t(_)}else n.be}}},{key:"remove",value:function(){var e=this.map;if(e){e.cesiumScene;var t=this.uuid,n=void 0;e.dm.each(function(e){e.uuid&&e.uuid===t&&(n=e)}),n&&e.dm.remove(n)}}},{key:"uuid",get:function(){return this.K}},{key:"map",get:function(){return this.$}},{key:"data",get:function(){return this.n}},{key:"property",get:function(){return this.ee}},{key:"dataType",get:function(){return this.ie}}]),n}();e.CesiumNode=g,e.CesiumPlugin=fe,e.Line=At,e.Map=mt,e.Node=wt,e.Point=kt,e.Scene=He,e.Tiles=Ze,Object.defineProperty(e,"__esModule",{value:!0})});
