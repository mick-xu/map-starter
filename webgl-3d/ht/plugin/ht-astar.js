!function(s,d,A){"use strict";var Z=s.ht;Z.Astar={},function(C){var X=C();s.AStar=X.astar,s.AStar.Graph=X.Graph}(function(){function U(Q){for(var d=Q,m=[];d.parent;)m.unshift(d),d=d.parent;return m}function M(){return new a(function(N){return N.f})}function G(G,y){y=y||{},this.nodes=[],this.diagonal=!!y.diagonal,this.grid=[];for(var A=0;A<G.length;A++){this.grid[A]=[];for(var S=0,d=G[A];S<d.length;S++){var i=new h(A,S,d[S]);this.grid[A][S]=i,this.nodes.push(i)}}this.$13x()}function h(x,N,t){this.x=x,this.y=N,this.weight=t}function a(U){this.content=[],this.scoreFunction=U}var p={search:function(C,S,J,R){C.$6x(),R=R||{};var K=R.heuristic;K||(K=C.diagonal?p.$4x.diagonal:p.$4x.manhattan);var n=R.closest||!1,v=R.punish,D=M(),o=S;for(S.h=K(S,J),C.$7x(S),D.push(S);D.size()>0;){var i=D.pop();if(i===J)return U(i);i.closed=!0;for(var s=C.neighbors(i),W=0,u=s.length;u>W;++W){var g=s[W];if(!g.closed&&!g.$9x()){var P=i.g+g.getCost(i,v),y=g.visited;(!y||P<g.g)&&(g.visited=!0,g.parent=i,g.h=g.h||K(g,J),g.g=P,g.f=g.g+g.h,C.$7x(g),n&&(g.h<o.h||g.h===o.h&&g.g<o.g)&&(o=g),y?D.$10x(g):D.push(g))}}}return n?U(o):[]},$4x:{manhattan:function(i,c){var O=Math.abs(c.x-i.x),R=Math.abs(c.y-i.y);return O+R},diagonal:function(t,h){var b=1,H=Math.sqrt(2),m=Math.abs(h.x-t.x),i=Math.abs(h.y-t.y);return b*(m+i)+(H-2*b)*Math.min(m,i)}},$5x:function(j){j.f=0,j.g=0,j.h=0,j.visited=!1,j.closed=!1,j.parent=null}};return G.prototype.$13x=function(){this.dirtyNodes=[];for(var Q=0;Q<this.nodes.length;Q++)p.$5x(this.nodes[Q])},G.prototype.$6x=function(){for(var n=0;n<this.dirtyNodes.length;n++)p.$5x(this.dirtyNodes[n]);this.dirtyNodes=[]},G.prototype.$7x=function(U){this.dirtyNodes.push(U)},G.prototype.neighbors=function(I){var $=[],V=I.x,c=I.y,p=this.grid;return p[V-1]&&p[V-1][c]&&$.push(p[V-1][c]),p[V+1]&&p[V+1][c]&&$.push(p[V+1][c]),p[V]&&p[V][c-1]&&$.push(p[V][c-1]),p[V]&&p[V][c+1]&&$.push(p[V][c+1]),this.diagonal&&(p[V-1]&&p[V-1][c-1]&&$.push(p[V-1][c-1]),p[V+1]&&p[V+1][c-1]&&$.push(p[V+1][c-1]),p[V-1]&&p[V-1][c+1]&&$.push(p[V-1][c+1]),p[V+1]&&p[V+1][c+1]&&$.push(p[V+1][c+1])),$},G.prototype.toString=function(){for(var Q=[],o=this.grid,w=0;w<o.length;w++){for(var A=[],j=o[w],F=0;F<j.length;F++)A.push(j[F].weight);Q.push(A.join(" "))}return Q.join("\n")},h.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},h.prototype.getCost=function(Y,O){var N;if(N=Y&&Y.x!=this.x&&Y.y!=this.y?1.41421*this.weight:this.weight,O){var k=Y;if(!k)return N;var G=k.parent;return G?Math.abs(G.x+this.x-2*k.x)>1e-5?N+O:Math.abs(G.y+this.y-2*k.y)>1e-5?N+O:N:N}},h.prototype.$9x=function(){return 0===this.weight},a.prototype={push:function(j){this.content.push(j),this.$11x(this.content.length-1)},pop:function(){var j=this.content[0],D=this.content.pop();return this.content.length>0&&(this.content[0]=D,this.$12x(0)),j},remove:function(h){var t=this.content.indexOf(h),z=this.content.pop();t!==this.content.length-1&&(this.content[t]=z,this.scoreFunction(z)<this.scoreFunction(h)?this.$11x(t):this.$12x(t))},size:function(){return this.content.length},$10x:function(i){this.$11x(this.content.indexOf(i))},$11x:function(M){for(var n=this.content[M];M>0;){var f=(M+1>>1)-1,Q=this.content[f];if(!(this.scoreFunction(n)<this.scoreFunction(Q)))break;this.content[f]=n,this.content[M]=Q,M=f}},$12x:function(c){for(var j=this.content.length,Q=this.content[c],o=this.scoreFunction(Q);;){var H,t=c+1<<1,_=t-1,s=null;if(j>_){var N=this.content[_];H=this.scoreFunction(N),o>H&&(s=_)}if(j>t){var I=this.content[t],F=this.scoreFunction(I);(null===s?o:H)>F&&(s=t)}if(null===s)break;this.content[c]=this.content[s],this.content[s]=Q,c=s}}},{astar:p,Graph:G}});var B=Z.Astar.Finder=function(i,T){var C=this;C.gv=i,C.$13x(T),C.refreshMap()};B.prototype={},B.prototype.constructor=B,d.defineProperties(B.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(h){this.gv._astarDebugInfo=h}}}),B.prototype.$13x=function(q){var N=this,E=N.$14x={};q=q||{};var B=q.gridSize||10;E.gridSizeX=q.gridSizeX||B,E.gridSizeY=q.gridSizeY||B,E.rect=q.rect,E.filter=q.filter,E.extendBlocks=q.extendBlocks||3,E.fastOverlap=q.fastOverlap===A?!0:q.fastOverlap,E.nodeRectExtend=q.nodeRectExtend||0,E.diagonal=q.diagonal===A?!0:q.diagonal,E.turnPunish=q.turnPunish===A?.1:q.turnPunish,E.simplify=q.simplify===A?!0:q.simplify,E.toGridCenter=q.toGridCenter===A?!1:q.toGridCenter,E.closest=q.closest===A?!0:q.closest},B.prototype.refreshMap=function(){var U,j=this,Y=j.$14x,T=Y.gridSizeX,O=Y.gridSizeY,p=Y.extendBlocks;Y.rect?U=Y.rect:(U=j.$15x(),Z.Default.grow(U,T*p,O*p)),Z.Default.grow(U,T,O);var b=Math.floor(U.x/T)*T,H=Math.floor(U.y/O)*O,k=Math.ceil(U.width/T),t=Math.ceil(U.height/O),R=k*T,E=t*O;j.$16x={x:b,y:H,w:R,h:E,gridX:T,gridY:O,xLen:k,yLen:t},j.$17x(),j.$21x()},B.prototype.$15x=function(){var x=this.gv;if(x instanceof Z.graph.GraphView)return x.getContentRect();var D,n=Z.Default.unionRect;return x.dm().each(function(f){x.isVisible(f)&&f.getRect&&(D=n(D,f.getRect()))}),D},B.prototype.$17x=function(){var c,t,o,K,z=this,k=z.$16x,V=k.xLen,W=k.yLen;for(c=new Array(V),o=0;V>o;o++)for(c[o]=t=new Array(W),K=W;K--;)t[K]=1;var L=z.$14x.filter;for(z.gv.dm().each(function(X){L&&L(X)===!1||(!z._debugInfo||X!==z._debugInfo.grid&&X!=z._debugInfo.path)&&z.$1cw(c,X)}),o=0;V>o;o++)c[o][0]=1,c[o][W-1]=1;for(K=0;W>K;K++)c[0][K]=1,c[V-1][K]=1;z.grid=c;var j=new AStar.Graph(c,{diagonal:z.$14x.diagonal});z.graph=j},B.prototype.$18x=function(T,N,a,S,W,z,U,P){var F=this.$19x,g=F(a-T,W-U,S-N,z-P);if(1e-6>=g&&g>=-1e-6)return!1;var w=F(W-T,W-U,z-N,z-P)/g;if(0>w||w>1)return!1;var s=F(a-T,W-T,S-N,z-N)/g;return 0>s||s>1?!1:!0},B.prototype.$19x=function(w,R,C,P){return w*P-R*C},B.prototype.$1aw=function(y,W,k,f){for(var x=[-(W[1]-y[1]),W[0]-y[0]],R=x[0]*(k[0]-y[0])+x[1]*(k[1]-y[1])>=0,N=0,I=f.length;I>N;N+=2)if(x[0]*(f[N]-y[0])+x[1]*(f[N+1]-y[1])>=0===R)return!1;return!0},B.prototype.$1bw=function(J,E){for(var Y,G,U=this,V=0,S=J.length;S>V;V+=2)if(Y=V===S-2?0:V+2,G=Y===S-2?0:Y+2,U.$1aw([J[V],J[V+1]],[J[Y],J[Y+1]],[J[G],J[G+1]],E))return!1;for(var V=0,S=E.length;S>V;V+=2)if(Y=V===S-2?0:V+2,G=Y===S-2?0:Y+2,U.$1aw([E[V],E[V+1]],[E[Y],E[Y+1]],[E[G],E[G+1]],J))return!1;return!0},B.prototype.$1cw=function(k,S){if(S.getRect){var J=this,e=S.getRect();Z.Default.grow(e,J.$14x.nodeRectExtend);var s,v,n,L,m,p,Y,W,H,d,G,T=J.$1dw({x:e.x,y:e.y}),q=J.$1dw({x:e.x+e.width,y:e.y+e.height}),l=J.$14x.fastOverlap;if(!l){var $=S.getCorners();Y=[],$.forEach(function(G){Y.push(G.x,G.y)}),d=J.$14x.gridSizeX/2,G=J.$14x.gridSizeY/2}for(v=Math.max(0,T.x),n=Math.min(q.x,k.length-1),m=Math.max(0,T.y),p=Math.min(q.y,k.length?k[0].length-1:-1),s=v;n>=s;s++)for(L=m;p>=L;L++)if(l)k[s][L]=0;else{H=J.$1ew({x:s,y:L});var I=H.x-d,D=H.x+d,R=H.y-G,o=H.y+G;W=[I,R,I,o,D,o,D,R],J.$1bw(Y,W)&&(k[s][L]=0)}}},B.prototype.$1dw=function(n,l){var v=this,d=v.$16x,$=(n.x-d.x)/d.gridX,h=(n.y-d.y)/d.gridY;return l!==!1&&($=Math.round($),h=Math.round(h)),{x:$,y:h}},B.prototype.$1ew=function(b){var F=this,d=F.$16x;return{x:b.x*d.gridX+d.x,y:b.y*d.gridY+d.y}},B.prototype.$1fw=function(C){var z=this,n=z.$16x,N=n.xLen,R=n.yLen;if(C.x>=0&&C.x<N&&C.y>=0&&C.y<R)return C;var t={x:C.x,y:C.y};return t.x<0?t.x=0:t.x>=N&&(t.x=N-1),t.y<0?t.y=0:t.y>=R&&(t.y=R-1),t},B.prototype.findPath=function(K,o){var Q,g,j,N,B=this,i=B.$1dw(K),r=B.$1dw(o);if(j=B.$1fw(i),N=B.$1fw(r),j!==i&&N!==r){var q=B.$16x,R=q.x-q.gridX/2,W=q.y-q.gridY/2,S=R+q.gridX*q.xLen,X=W+q.gridY*q.yLen;if(!(B.$18x(K.x,K.y,o.x,o.y,R,W,S,W)||B.$18x(K.x,K.y,o.x,o.y,S,W,S,X)||B.$18x(K.x,K.y,o.x,o.y,S,X,R,X)||B.$18x(K.x,K.y,o.x,o.y,R,X,R,W)))return[K,o]}j!==i&&(Q=!0,i=j),N!==r&&(g=!0,r=N);var l=B.graph.grid[i.x][i.y],w=B.graph.grid[r.x][r.y],J=AStar.search(B.graph,l,w,{closest:B.$14x.closest,punish:B.$14x.turnPunish});if(!J||!J.length)return null;var t=[];t.push(K),Q&&t.push(B.$1ew(J[0]));for(var C=1,k=J.length;k-1>C;C++)t.push(B.$1ew(J[C]));if(g)t.push(B.$1ew(J[k-1])),t.push(o);else{var D=J[k-1];r.x!==D.x||r.y!==D.y||B.$14x.toGridCenter?t.push(B.$1ew(D)):t.push(o)}return B.$14x.simplify&&(t=B.simplifyPath(t)),B.$20x=t,B.$21x(),t},B.prototype.debugOn=function(B){this.debugFlag=!0,this.debugSettings=B||{},this.$21x()},B.prototype.simplifyPath=function(y){var V=y.length;if(2>=V)return y;var W,F,x=[y[0],y[1]],J=x[0],P=x[1],M=1e-5;for(W=2;V>W;W++)F=y[W],Math.abs((P.x-J.x)*(F.y-J.y)-(P.y-J.y)*(F.x-J.x))<M?P=x[x.length-1]=F:(J=P,P=F,x.push(F));return x},B.prototype.$21x=function(){var w=this;if(w.$22x(),this.debugFlag){var W=w.grid;if(W){var Q,B=w.gv;if(w.debugSettings.$16x!==!1){Q=[];for(var X,k,K,D,H,g=[],f=w.$14x.gridSizeX/2,Y=w.$14x.gridSizeY/2,z=W.length,A=z?W[0].length:0,V=1;z-1>V;V++)for(var N=1;A-1>N;N++)W[V][N]||(X=w.$1ew({x:V,y:N}),k=X.x-f,K=X.x+f,D=X.y-Y,H=X.y+Y,Q.push({x:k,y:D},{x:k,y:H},{x:K,y:H},{x:K,y:D}),g.push(1,2,2,2,5));var U=new Z.Shape;U.s("shape.border.color","rgba(50, 50, 50, 0.2)"),U.s("shape.border.width",1),U.s("shape.background","rgba(200, 50, 100, 0.2)"),U.s("2d.editable",!1),U.s("2d.selectable",!1),U.setPoints(Q),U.setSegments(g),w._debugInfo={grid:U},B.dm().add(U)}w.debugSettings.path!==!1&&(Q=new Z.Shape,w.$20x&&(Q.setPoints(w.$20x),Q.s("shape.border.color","red"),Q.s("shape.border.width",1),Q.s("2d.editable",!1),Q.s("2d.selectable",!1),Q.s("shape.background",null),w._debugInfo||(w._debugInfo={}),w._debugInfo.path=Q,B.dm().add(Q)))}}},B.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},B.prototype.$22x=function(){var W=this;if(W._debugInfo){var H=W._debugInfo.grid,p=W._debugInfo.path,Z=W.gv;H&&Z.dm().remove(H),p&&Z.dm().remove(p),W._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);